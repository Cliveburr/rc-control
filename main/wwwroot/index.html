<!DOCTYPE html><html><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>RC Control</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css><style>body,html{overflow:hidden!important;height:100%;width:100%;margin:0;font-family:Inter,"SF Pro","Segoe UI",Roboto,Oxygen,Ubuntu,"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:large}img{height:80%;width:90%}.control{display:flex;align-items:center;justify-content:center}.control-track{border-radius:10px;position:relative;box-shadow:inset 0 2px 8px rgba(0,0,0,.3);border:2px solid #333;cursor:pointer}.control-zero-line{position:absolute;background:#000;border-radius:2px;box-shadow:0 0 5px rgba(0,0,0,.5);z-index:2}.control-indicator{position:absolute;z-index:1;cursor:pointer;transition:top .1s ease-out}.control-thumb{background:radial-gradient(circle,#fff 0,#e0e0e0 70%,#999 100%);border:3px solid #333;border-radius:50%;box-shadow:0 4px 12px rgba(0,0,0,.4);display:flex;align-items:center;justify-content:center;position:relative}.control-thumb:before{content:'';width:8px;height:8px;background:#333;border-radius:50%}.control-thumb:active{transform:scale(1.1);box-shadow:0 6px 16px rgba(0,0,0,.5)}.control *{user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}.speed{align-self:stretch;width:120px}.speed-control{width:80px;height:100%;display:flex;flex-direction:column;align-items:center;position:relative}.speed-track{width:80px;height:100%;background:linear-gradient(to bottom,#f44 0,#f84 20%,#fa4 40%,#4f4 60%,#4af 80%,#44f 100%)}.speed-zero-line{top:66.67%;left:-5px;right:-5px;height:3px}.speed-indicator{top:66.67%;left:50%;transform:translate(-50%,-50%);width:90px;height:20px}.speed-thumb{width:87px;height:18px}.wheels{align-self:stretch;height:80px;width:240px;display:flex;align-items:center;justify-content:center}.wheels-control{width:100%;height:50px;display:flex;flex-direction:row;align-items:center;position:relative}.wheels-track{width:100%;height:50px;background:linear-gradient(to right,#f44 0,#f84 20%,#fa4 40%,#4f4 50%,#4af 60%,#48f 80%,#44f 100%)}.wheels-zero-line{left:50%;top:-5px;bottom:-5px;width:3px}.wheels-indicator{left:50%;top:50%;transform:translate(-50%,-50%);width:20px;height:60px;transition:left .1s ease-out}.wheels-thumb{width:18px;height:57px}.btn{background-color:#0ff;height:70px;width:70px;border:none;border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .3s ease}.btn:hover{transform:scale(1.05);box-shadow:0 4px 8px rgba(0,0,0,.2)}.btn-config{background:linear-gradient(135deg,#667eea 0,#764ba2 100%);color:#fff;font-size:24px}.btn-config:hover{background:linear-gradient(135deg,#5a6fd8 0,#6a4190 100%);transform:scale(1.05) rotate(90deg)}.btn-horn{background:linear-gradient(135deg,#ff6b6b 0,#ee5a24 100%);color:#fff;font-size:24px;box-shadow:0 4px 8px rgba(255,107,107,.3)}.btn-horn:hover{background:linear-gradient(135deg,#ff5252 0,#d63031 100%);transform:scale(1.1);box-shadow:0 6px 12px rgba(255,107,107,.4)}.btn-horn.active{transform:scale(.95);box-shadow:0 0 20px rgba(255,107,107,.8),0 0 40px rgba(255,107,107,.4)}.btn-light{background:linear-gradient(135deg,#6c757d 0,#495057 100%);color:#adb5bd;font-size:24px;box-shadow:0 4px 8px rgba(108,117,125,.3);transition:all .3s ease}.btn-light:hover{background:linear-gradient(135deg,#6c757d 0,#495057 100%);color:#adb5bd;box-shadow:0 4px 8px rgba(108,117,125,.3)}.btn-light.active{background:linear-gradient(135deg,#ffc107 0,#ffca2c 100%)!important;color:#212529!important;box-shadow:0 0 20px rgba(255,193,7,.8),0 0 40px rgba(255,193,7,.4)!important}.view0{position:absolute;top:0;margin:5px;height:calc(100% - 20px);width:calc(100% - 20px)}.view1{position:absolute;top:0;margin:10px;height:calc(100% - 40px);width:calc(100% - 40px);z-index:1000}.cols{display:flex}.colsi{display:flex;flex-direction:row-reverse}.rows{display:flex;flex-direction:column}.grow{flex-grow:1}.gap{gap:10px}.m0{margin:10px}.m1{margin:20px}.w100{width:100%}.h100{height:100%}.wh100{width:100%;height:100%}.end{align-self:flex-end}.space-between{justify-content:space-between}.card{display:flex;flex-direction:column;background-color:#d9dadee8;box-shadow:rgba(9,10,12,.1) 0 8px 16px -2px,rgba(9,10,12,.02) 0 0 0 1px;color:#404654;max-width:100%;position:relative;border-radius:8px}.card-header{height:48px;background-color:#d9dade85;box-shadow:rgba(9,10,12,.1) 0 2px 4px 0;box-sizing:border-box;color:#404654;display:flex;font-size:20px;font-weight:600;padding-left:10px;align-items:center;justify-content:space-between}.card-close-btn{background:0 0;border:none;font-size:24px;color:#404654;cursor:pointer;padding:5px 10px;border-radius:4px;transition:background-color .2s}.card-close-btn:hover{background-color:rgba(64,70,84,.1)}.card-body{display:flex;flex-direction:column;gap:10px;padding:10px;height:100%}input{display:inline-flex;align-items:center;box-shadow:rgba(9,10,12,.05) 0 1px 2px 0 inset;border:1px solid #001adb;border-radius:6px;padding:11px}button{display:flex;align-items:center;justify-content:center;background-color:#00b89c;border:0;box-shadow:rgba(51,51,51,0) 0 1px 2px 0,rgba(51,51,51,0) 0 2px 4px 0;cursor:pointer;height:40px;font-weight:500;padding:16px}.tab-left{display:flex}.tab-left ul{margin:5px;padding:0;display:flex;flex-direction:column;gap:5px;min-width:120px;width:120px}.tab-left li{display:flex;align-items:center;justify-content:center;list-style-position:outside;list-style-type:none;list-style-image:none;width:100%;height:24px;background-color:#00f;border-radius:6px;border:1px solid #d9dade85;color:#e3d2d2;font-weight:500;font-size:14px;padding:4px 8px}.tab-left>div{flex-grow:1}.tab-item{cursor:pointer;transition:background-color .3s}.tab-item:hover{background-color:#0056b3}.tab-item.active{background-color:#007bff}.tab-content{flex-grow:1;padding:15px;overflow-y:auto;max-height:calc(100vh - 120px)}.tab-panel{display:none}.tab-panel.active{display:block}.tab-panel h3{margin-top:0;margin-bottom:20px;color:#404654}.tab-panel label{display:block;margin-bottom:5px;font-weight:500;color:#404654}.tab-panel select{display:inline-flex;align-items:center;box-shadow:rgba(9,10,12,.05) 0 1px 2px 0 inset;border:1px solid #001adb;border-radius:6px;padding:11px;width:100%;margin-bottom:15px}.button-group{margin-top:20px;display:flex;gap:10px}.status-info{background-color:#f8f9fa;border:1px solid #dee2e6;border-radius:6px;padding:15px;margin-bottom:20px;font-family:monospace;font-size:14px}.progress-container{margin-top:20px}.progress-bar{width:100%;height:20px;background-color:#e9ecef;border-radius:10px;overflow:hidden}.progress-fill{height:100%;background-color:#28a745;width:0%;transition:width .3s ease}.progress-container #progressText{text-align:center;margin-top:10px;font-weight:500}.system-info{font-size:14px}.info-section{margin-bottom:25px;border:1px solid #dee2e6;border-radius:8px;padding:15px;background-color:#f8f9fa}.info-section h4{margin:0 0 15px 0;color:#495057;font-size:16px;font-weight:600;border-bottom:1px solid #dee2e6;padding-bottom:8px}.info-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px}.info-item{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background-color:#fff;border-radius:4px;border:1px solid #e9ecef}.info-label{font-weight:500;color:#6c757d}.info-value{font-weight:600;color:#212529;font-family:monospace}.memory-bar{margin-bottom:15px}.memory-progress{width:100%;height:24px;background-color:#e9ecef;border-radius:12px;overflow:hidden;margin-bottom:8px}.memory-fill{height:100%;background:linear-gradient(90deg,#28a745 0,#ffc107 70%,#dc3545 90%);width:0%;transition:width .5s ease}.memory-text{text-align:center;font-weight:600;color:#495057;font-family:monospace;font-size:13px}.system-info .button-group{justify-content:center}.battery-indicator{display:flex;align-items:center;justify-content:center;width:70px;height:70px;position:relative}.battery-body{width:60px;height:40px;background:#333;border:2px solid #666;border-radius:3px;position:relative;display:flex;flex-direction:row;justify-content:space-between;align-items:center;padding:2px 4px;box-sizing:border-box}.battery-tip{width:8px;height:24px;background:#666;border-radius:0 2px 2px 0;position:absolute;right:-3px;top:50%;transform:translateY(-50%)}.battery-level{width:4px;height:32px;background:#111;border-radius:1px;margin:0 1px;transition:background-color .3s ease}.battery-level.active.level-1,.battery-level.active.level-2,.battery-level.active.level-3{background:#dc3545}.battery-level.active.level-4,.battery-level.active.level-5,.battery-level.active.level-6,.battery-level.active.level-7{background:#ffc107}.battery-level.active.level-10,.battery-level.active.level-8,.battery-level.active.level-9{background:#28a745}</style><script>let DEBUG=!1;function makeView(){document.getElementsByTagName("img")[0].src="/video?"+(new Date).getTime()}let ws=null,batteryType="1S";function initWebSocket(){if(DEBUG)console.log("DEBUG mode: WebSocket disabled for testing");else try{(ws=new WebSocket(`ws://${window.location.host}/ws`)).onopen=()=>{console.log("WebSocket connected for control commands")},ws.onmessage=e=>{handleWebSocketMessage(e.data)},ws.onclose=()=>{console.log("WebSocket closed"),setTimeout(initWebSocket,3e3)},ws.onerror=e=>{console.error("WebSocket error:",e)}}catch(e){console.error("Failed to initialize WebSocket:",e)}}function handleWebSocketMessage(t){try{var e=JSON.parse(t);switch(console.log("Received WebSocket message:",e),e.type){case"init":handleInitMessage(e);break;case"battery":handleBatteryMessage(e);break;default:console.log("Unknown message type:",e.type)}}catch(e){console.error("Failed to parse WebSocket message:",e,t)}}function handleInitMessage(e){e.battery_type&&(batteryType=e.battery_type,console.log("Battery type configured:",batteryType))}function handleBatteryMessage(e){var t;"number"==typeof e.voltage&&(updateBatteryLevel(t=calculateBatteryLevel(e=e.voltage,batteryType)),console.log(`Battery: ${e.toFixed(2)}V (${t}/10 levels, ${batteryType})`))}function calculateBatteryLevel(e,t){let o,n;if("1S"===t)o=3,n=4.2;else{if("2S"!==t)return console.error("Unknown battery type:",t),0;o=6,n=8.4}t=Math.max(0,Math.min(100,(e-o)/(n-o)*100)),e=Math.floor(t/10);return Math.max(0,Math.min(10,e))}function sendSpeedCommand(e){sendControlCommand("speed",e)}function sendWheelsCommand(e){sendControlCommand("wheels",e)}function sendControlCommand(e,t){var o;DEBUG?console.log(`DEBUG mode: ${e} command (visual test only):`,t):ws&&ws.readyState===WebSocket.OPEN?(o={type:e,value:t},ws.send(JSON.stringify(o)),console.log(e+" command sent:",t)):console.warn(`WebSocket not connected, cannot send ${e} command:`,t)}function sendHornCommand(e){var t;DEBUG?console.log("DEBUG mode: Horn command (visual test only):",e):ws&&ws.readyState===WebSocket.OPEN?(t={type:"horn",value:e?1:0},ws.send(JSON.stringify(t)),console.log("Horn command sent:",e)):console.warn("WebSocket not connected, cannot send horn command:",e)}function sendLightCommand(e){var t;console.log("sendLightCommand called with:",e),DEBUG?console.log("DEBUG mode: Light command (visual test only):",e):ws&&ws.readyState===WebSocket.OPEN?(t={type:"light",value:e?1:0},ws.send(JSON.stringify(t)),console.log("Light command sent:",e)):console.warn("WebSocket not connected, cannot send light command:",e)}function initGenericControl(u,h){let p=document.getElementById(u+"Indicator");if(p){let r=p.parentElement,i="speed"===u,l=i?66.67:50,d=[],c=0,m=0,n=!1,a={x:0,y:0},s=0;function g(e){e=Math.max(0,Math.min(100,e)),i?p.style.top=e+"%":p.style.left=e+"%";t=e;var t,o=i?(o=(l-t)/l,t<l?Math.round(100*o):(o=100-l,o=(t-l)/o,Math.round(100*-o))):Math.round(2*(t-50));h(o),DEBUG&&console.log(`${u}: Posição ${e.toFixed(1)}%, Valor: `+o)}function y(){var e;DEBUG&&console.log(u+": Verificando zona de reset"),i?(e=parseFloat(p.style.top)||l,(e=Math.abs(e-l))<=10?(DEBUG&&console.log(`${u}: Dentro da zona de reset (${e.toFixed(1)}%), retornando ao zero`),p.style.transition="top 0.3s ease-out",g(l),setTimeout(()=>{p.style.transition="top 0.1s ease-out"},300)):(DEBUG&&console.log(`${u}: Fora da zona de reset (${e.toFixed(1)}%), mantendo posição atual`),p.style.transition="top 0.1s ease-out")):(DEBUG&&console.log(u+": Retornando ao centro (comportamento wheels)"),p.style.transition="left 0.3s ease-out",g(l),setTimeout(()=>{p.style.transition="left 0.1s ease-out"},300))}function f(t){for(let e=0;e<d.length;e++)if(d[e].identifier===t)return{touch:d[e],index:e};return null}function v(e){var t=r.getBoundingClientRect();let o;return o=i?(e.clientY-t.top)/t.height*100:(e.clientX-t.left)/t.width*100,Math.max(0,Math.min(100,o))}function e(t){if(t.preventDefault(),DEBUG&&console.log(u+": touchstart - targetTouches: "+t.targetTouches.length),i&&1===t.targetTouches.length){var e=Date.now();if(e-c<300){if(2===++m){var o=v(t.targetTouches[0]);if(Math.abs(o-l)<=15)return DEBUG&&console.log(u+": Duplo toque detectado na zona zero, forçando reset"),DEBUG&&console.log(u+": Reset forçado ao zero"),i?p.style.transition="top 0.3s ease-out":p.style.transition="left 0.3s ease-out",g(l),setTimeout(()=>{i?p.style.transition="top 0.1s ease-out":p.style.transition="left 0.1s ease-out"},300),void(m=0)}}else m=1;c=e}for(let e=0;e<t.targetTouches.length;e++){var n,a,s=t.targetTouches[e];f(s.identifier)||(n=v(s),a={identifier:s.identifier,startX:s.clientX,startY:s.clientY,currentPercent:n,initialPercent:n},d.push(a),1===d.length&&(p.style.transition="none",g(n),DEBUG)&&console.log(`${u}: Primeiro toque iniciado (ID: ${s.identifier})`))}}function t(t){t.preventDefault();for(let e=0;e<t.targetTouches.length;e++){var o,n,a=t.targetTouches[e],s=f(a.identifier);s&&(n=a.clientX-s.touch.startX,a=a.clientY-s.touch.startY,o=i?r.clientHeight:r.clientWidth,a=(i?a:n)/o*100,n=s.touch.initialPercent+a,s.touch.currentPercent=n,0===s.index)&&g(n)}}function o(t){t.preventDefault(),DEBUG&&console.log(u+": touchend - changedTouches: "+t.changedTouches.length);for(let e=0;e<t.changedTouches.length;e++){var o=t.changedTouches[e],n=f(o.identifier);n&&(DEBUG&&console.log(`${u}: Removendo toque (ID: ${o.identifier})`),d.splice(n.index,1),0===d.length)&&(DEBUG&&console.log(u+": Último toque removido, retornando ao zero"),y())}}function E(e){DEBUG&&console.log(u+": touchcancel"),o(e)}function b(t){if(!(0<d.length)){t.preventDefault(),n=!0;var o=r.getBoundingClientRect();let e;e=i?(t.clientY-o.top)/o.height*100:(t.clientX-o.left)/o.width*100,a={x:t.clientX,y:t.clientY},s=e,p.style.transition="none",g(e),DEBUG&&console.log(`${u}: Mouse down (${e.toFixed(1)}%)`)}}function w(e){var t,o;n&&(e.preventDefault(),t=e.clientX-a.x,e=e.clientY-a.y,o=i?r.clientHeight:r.clientWidth,e=(i?e:t)/o*100,g(s+e))}function B(e){n&&(n=!1,y(),DEBUG)&&console.log(u+": Mouse up")}p.addEventListener("touchstart",e,{passive:!1}),p.addEventListener("touchmove",t,{passive:!1}),p.addEventListener("touchend",o,{passive:!1}),p.addEventListener("touchcancel",E,{passive:!1}),r.addEventListener("touchstart",e,{passive:!1}),r.addEventListener("touchmove",t,{passive:!1}),r.addEventListener("touchend",o,{passive:!1}),r.addEventListener("touchcancel",E,{passive:!1}),p.addEventListener("mousedown",b),r.addEventListener("mousedown",b),p.addEventListener("mousemove",w),r.addEventListener("mousemove",w),p.addEventListener("mouseup",B),r.addEventListener("mouseup",B),p.addEventListener("mouseleave",B),r.addEventListener("mouseleave",B),g(l),DEBUG&&console.log(u+": Controle inicializado com cache local")}else console.error(u+" control elements not found. Retrying in 100ms..."),setTimeout(()=>initGenericControl(u,h),100)}function initSpeedControl(){initGenericControl("speed",sendSpeedCommand)}function initWheelsControl(){initGenericControl("wheels",sendWheelsCommand)}class ViewInst{constructor(e,t){this.parentCtx=t,this.html=e.cloneNode(!0),this.ctx={},this.setupCloseButtons()}setupCloseButtons(){this.html.querySelectorAll('[data-close-view="true"]').forEach(e=>{e.addEventListener("click",()=>{this.close()})})}setOnclick(e,t){this.html.querySelector("#"+e).onclick=t}close(){document.body.removeChild(this.html)}}class View{constructor(e,t){this.ctr=t,this.template=document.getElementById(e),document.body.removeChild(this.template)}show(e){e=new ViewInst(this.template,e);return this.ctr&&this.ctr(e),document.body.appendChild(e.html),e}}function mainCtr(e){setTimeout(()=>{initSpeedControl(),initWheelsControl()},0),e.setOnclick("btnConfiguration",()=>{views.configurationView.show()});let o=e.html.querySelector("#btnHorn");if(o){let t=!1;o.addEventListener("mousedown",e=>{t||(t=!0,o.classList.add("active"),sendHornCommand(!0)),e.preventDefault()}),o.addEventListener("mouseup",e=>{t&&(t=!1,o.classList.remove("active"),sendHornCommand(!1)),e.preventDefault()}),o.addEventListener("mouseleave",e=>{t&&(t=!1,o.classList.remove("active"),sendHornCommand(!1))}),o.addEventListener("touchstart",e=>{t||(t=!0,o.classList.add("active"),sendHornCommand(!0)),e.preventDefault(),e.stopPropagation()}),o.addEventListener("touchend",e=>{t&&(t=!1,o.classList.remove("active"),sendHornCommand(!1)),e.preventDefault(),e.stopPropagation()}),o.addEventListener("touchcancel",e=>{t&&(t=!1,o.classList.remove("active"),sendHornCommand(!1)),e.preventDefault(),e.stopPropagation()})}let t=e.html.querySelector("#btnLight"),n=!1;t?(t.addEventListener("click",e=>{(n=!n)?t.classList.add("active"):t.classList.remove("active"),sendLightCommand(n),e.preventDefault()}),t.addEventListener("touchend",e=>{e.preventDefault(),e.stopPropagation(),(n=!n)?t.classList.add("active"):t.classList.remove("active"),sendLightCommand(n)})):console.error("Light button not found!")}function netCtr(e){let o=e.html.querySelectorAll(".tab-item"),n=e.html.querySelectorAll(".tab-panel");o.forEach(t=>{t.addEventListener("click",()=>{o.forEach(e=>e.classList.remove("active")),n.forEach(e=>e.classList.remove("active")),t.classList.add("active");var e=t.id.replace("tab","tab")+"Content";document.getElementById(e).classList.add("active")})}),e.html.querySelector("#tabOTA").addEventListener("click",loadOTAStatus),e.html.querySelector("#tabInfo").addEventListener("click",loadSystemInfo),e.html.querySelector("#saveWifiConfig").addEventListener("click",saveWifiConfig),e.html.querySelector("#uploadOTA").addEventListener("click",uploadOTAFirmware),e.html.querySelector("#refreshSystemInfo").addEventListener("click",loadSystemInfo)}async function loadOTAStatus(){try{var e=await(await fetch("/ota/status")).json();document.getElementById("otaStatus").innerHTML=`
            <strong>Partição em execução:</strong> ${e.running_partition}<br>
            <strong>Partição de boot:</strong> ${e.boot_partition}<br>
            <strong>OTA em progresso:</strong> ${e.ota_in_progress?"Sim":"Não"}
        `}catch(e){console.error("Erro ao carregar status OTA:",e),document.getElementById("otaStatus").innerHTML="Erro ao carregar informações do sistema."}}function saveWifiConfig(){var e=document.getElementById("wifiSsid").value,t=document.getElementById("wifiPassword").value;e?(alert("Configuração WiFi salva com sucesso!"),console.log("WiFi Config:",{ssid:e,password:t})):alert("Por favor, insira o nome da rede WiFi")}async function uploadOTAFirmware(){let s=document.getElementById("otaFile");var r=s.files[0];if(r)if(r.name.endsWith(".bin")){let t=document.getElementById("otaProgress"),o=document.getElementById("progressBar"),n=document.getElementById("progressText"),a=document.getElementById("uploadOTA");t.style.display="block",a.disabled=!0,a.textContent="Enviando...";try{(new FormData).append("firmware",r);let e=new XMLHttpRequest;e.upload.addEventListener("progress",e=>{e.lengthComputable&&(e=e.loaded/e.total*100,o.style.width=e+"%",n.textContent=Math.round(e)+"%")}),e.onload=function(){if(200===e.status)try{JSON.parse(e.responseText);alert("Firmware enviado com sucesso! O dispositivo será reiniciado."),s.value="",t.style.display="none"}catch(e){alert("Firmware enviado com sucesso! O dispositivo será reiniciado.")}else alert("Erro no upload: "+e.responseText);a.disabled=!1,a.textContent="Atualizar Firmware",t.style.display="none"},e.onerror=function(){alert("Erro na conexão durante o upload"),a.disabled=!1,a.textContent="Atualizar Firmware",t.style.display="none"},e.open("POST","/ota/upload"),e.send(r)}catch(e){console.error("Erro no upload OTA:",e),alert("Erro ao enviar firmware"),a.disabled=!1,a.textContent="Atualizar Firmware",t.style.display="none"}}else alert("Por favor, selecione um arquivo .bin válido");else alert("Por favor, selecione um arquivo .bin")}async function loadSystemInfo(){try{resetSystemInfoDisplay();let e;if(!(e=DEBUG?{ok:!0,json:async()=>({chip:{model:"ESP32-S3",cores:2,revision:3,cpu_freq_mhz:240,has_wifi:!0,has_bluetooth:!0,has_ble:!0,flash_size_mb:16},memory:{heap:{total_bytes:327680,used_bytes:98304,free_bytes:229376,usage_percent:30},psram:{total_bytes:8388608,used_bytes:1048576,free_bytes:7340032,usage_percent:12},dma:{total_bytes:262144,used_bytes:32768,free_bytes:229376,usage_percent:12},iram:{total_bytes:131072,used_bytes:65536,free_bytes:65536,usage_percent:50},dram:{total_bytes:524288,used_bytes:157286,free_bytes:367002,usage_percent:30}}})}:await fetch("/api/system-info")).ok)throw new Error("Failed to fetch system info");updateSystemInfoDisplay(await e.json())}catch(e){console.error("Erro ao carregar informações do sistema:",e),showSystemInfoError()}}function resetSystemInfoDisplay(){["chipModel","chipCores","chipRevision","cpuFreq","hasWifi","hasBluetooth","flashSize","heapTotal","heapUsed","heapFree","heapUsage","psramTotal","psramUsed","psramFree","psramUsage","dmaTotal","dmaUsed","dmaFree","dmaUsage","iramTotal","iramUsed","iramFree","iramUsage","dramTotal","dramUsed","dramFree","dramUsage"].forEach(e=>{e=document.getElementById(e);e&&(e.textContent="Carregando...")}),["heapProgressBar","psramProgressBar","dmaProgressBar","iramProgressBar","dramProgressBar"].forEach(e=>{e=document.getElementById(e);e&&(e.style.width="0%")})}function updateSystemInfoDisplay(e){document.getElementById("chipModel").textContent=e.chip.model||"--",document.getElementById("chipCores").textContent=e.chip.cores||"--",document.getElementById("chipRevision").textContent=e.chip.revision||"--",document.getElementById("cpuFreq").textContent=(e.chip.cpu_freq_mhz||"--")+" MHz",document.getElementById("hasWifi").textContent=e.chip.has_wifi?"Sim":"Não",document.getElementById("hasBluetooth").textContent=e.chip.has_bluetooth?"Sim":"Não",document.getElementById("flashSize").textContent=(e.chip.flash_size_mb||"--")+" MB",updateMemoryInfo("heap",e.memory.heap),updateMemoryInfo("psram",e.memory.psram),updateMemoryInfo("dma",e.memory.dma),updateMemoryInfo("iram",e.memory.iram),updateMemoryInfo("dram",e.memory.dram)}function updateMemoryInfo(e,t){var o=Math.round(t.total_bytes/1024),n=Math.round(t.used_bytes/1024),a=Math.round(t.free_bytes/1024),t=t.usage_percent||0,a=(document.getElementById(e+"Total").textContent=o+" KB",document.getElementById(e+"Used").textContent=n+" KB",document.getElementById(e+"Free").textContent=a+" KB",document.getElementById(e+"Usage").textContent=n+` / ${o} KB (${t}%)`,document.getElementById(e+"ProgressBar"));a&&(a.style.width=t+"%")}function showSystemInfoError(){["chipModel","chipCores","chipRevision","cpuFreq","hasWifi","hasBluetooth","flashSize","heapTotal","heapUsed","heapFree","heapUsage","psramTotal","psramUsed","psramFree","psramUsage","dmaTotal","dmaUsed","dmaFree","dmaUsage","iramTotal","iramUsed","iramFree","iramUsage","dramTotal","dramUsed","dramFree","dramUsage"].forEach(e=>{e=document.getElementById(e);e&&(e.textContent="Erro")})}let batteryLevel=0,batteryDirection=1;function updateBatteryLevel(t){var o=document.querySelectorAll(".battery-level");o.forEach(e=>{e.classList.remove("active")});for(let e=0;e<Math.min(t,10);e++)o[e].classList.add("active")}function startBatteryDebugLoop(){DEBUG&&setInterval(()=>{10<=(batteryLevel+=batteryDirection)?batteryDirection=-1:batteryLevel<=0&&(batteryDirection=1),updateBatteryLevel(batteryLevel),console.log("Battery level debug:",batteryLevel)},1e3)}function preventDefaultBehaviors(){document.addEventListener("gesturestart",e=>{e.preventDefault()}),document.addEventListener("gesturechange",e=>{e.preventDefault()}),document.addEventListener("gestureend",e=>{e.preventDefault()});let n=0;document.addEventListener("touchend",e=>{var t,o=(new Date).getTime();o-n<=300&&((t=e.target).closest(".control")||t.closest(".btn")||"btnHorn"===t.id||"btnLight"===t.id||"btnConfiguration"===t.id||e.preventDefault()),n=o},!1),document.addEventListener("contextmenu",e=>{var t=e.target;(t.closest(".control")||t.closest(".btn")||"btnHorn"===t.id||"btnLight"===t.id||"btnConfiguration"===t.id)&&e.preventDefault()})}let views={};function main(){preventDefaultBehaviors(),(DEBUG?(console.log("DEBUG mode enabled: Running in visual test mode without WebSocket"),startBatteryDebugLoop):initWebSocket)(),views.mainView=new View("mainView",mainCtr),views.configurationView=new View("configurationView",netCtr),views.mainView.show()}window.onload=main</script></head><body><div id=mainView class="gap cols view0"><div class="control speed"><div class=speed-control><div class="control-track speed-track"><div class="control-zero-line speed-zero-line"></div><div class="control-indicator speed-indicator" id=speedIndicator><div class="control-thumb speed-thumb"></div></div></div></div></div><div class="gap space-between grow rows"><div class="gap cols space-between"><div class="gap cols"><div id=btnHorn class="btn btn-horn"><i class="fa-2x fas fa-volume-up"></i></div><div id=btnLight class="btn btn-light"><i class="fa-2x fas fa-lightbulb"></i></div></div><div class="gap cols"><div id=batteryIndicator class=battery-indicator><div class=battery-body><div class="battery-level level-1"></div><div class="battery-level level-2"></div><div class="battery-level level-3"></div><div class="battery-level level-4"></div><div class="battery-level level-5"></div><div class="battery-level level-6"></div><div class="battery-level level-7"></div><div class="battery-level level-8"></div><div class="battery-level level-9"></div><div class="battery-level level-10"></div></div><div class=battery-tip></div></div><div id=btnConfiguration class="btn btn-config"><i class="fa-2x fas fa-cog"></i></div></div></div><div class=colsi><div class="control wheels"><div class=wheels-control><div class="control-track wheels-track"><div class="control-zero-line wheels-zero-line"></div><div class="control-indicator wheels-indicator" id=wheelsIndicator><div class="control-thumb wheels-thumb"></div></div></div></div></div></div></div></div><div id=configurationView class="panel view1"><div class="card wh100"><header class=card-header><span>Configuração</span> <button class=card-close-btn data-close-view=true>✕</button></header><div class=card-body><div class=tab-left><ul><li id=tabGeneral class="tab-item active">General</li><li id=tabWifi class=tab-item>Wifi</li><li id=tabOTA class=tab-item>Update</li><li id=tabInfo class=tab-item>Info</li></ul><div class=tab-content><div id=tabGeneralContent class="tab-panel active"><h3>Configuração Geral</h3><label>Tipo de Conexão:</label> <select id=connectionType><option value=wifi>WiFi</option><option value=bluetooth>Bluetooth</option></select></div><div id=tabWifiContent class=tab-panel><h3>Configuração WiFi</h3><label>Nome do WiFi (SSID):</label> <input id=wifiSsid type=text placeholder="Nome da rede WiFi"> <label>Senha do WiFi:</label> <input id=wifiPassword type=password placeholder="Senha da rede WiFi"><div class=button-group><button id=saveWifiConfig>Gravar</button></div></div><div id=tabOTAContent class=tab-panel><h3>Atualização</h3><div id=otaStatus class=status-info>Carregando informações...</div><label>Selecionar arquivo .bin:</label> <input id=otaFile type=file accept=.bin><div class=button-group><button id=uploadOTA>Atualizar Firmware</button></div><div id=otaProgress class=progress-container style=display:none><div class=progress-bar><div id=progressBar class=progress-fill></div></div><div id=progressText>0%</div></div></div><div id=tabInfoContent class=tab-panel><h3>Informações do Sistema</h3><div id=systemInfo class=system-info><div class=info-section><h4>Chip</h4><div class=info-grid><div class=info-item><span class=info-label>Modelo:</span> <span id=chipModel class=info-value>--</span></div><div class=info-item><span class=info-label>Núcleos:</span> <span id=chipCores class=info-value>--</span></div><div class=info-item><span class=info-label>Revisão:</span> <span id=chipRevision class=info-value>--</span></div><div class=info-item><span class=info-label>Frequência CPU:</span> <span id=cpuFreq class=info-value>-- MHz</span></div><div class=info-item><span class=info-label>WiFi:</span> <span id=hasWifi class=info-value>--</span></div><div class=info-item><span class=info-label>Bluetooth:</span> <span id=hasBluetooth class=info-value>--</span></div><div class=info-item><span class=info-label>Flash:</span> <span id=flashSize class=info-value>-- MB</span></div></div></div><div class=info-section><h4>Memória Heap (Região da RAM usada para alocação dinâmica)</h4><div class=memory-bar><div class=memory-progress><div id=heapProgressBar class=memory-fill></div></div><div class=memory-text><span id=heapUsage>-- / -- KB (-- %)</span></div></div><div class=info-grid><div class=info-item><span class=info-label>Total:</span> <span id=heapTotal class=info-value>-- KB</span></div><div class=info-item><span class=info-label>Usado:</span> <span id=heapUsed class=info-value>-- KB</span></div><div class=info-item><span class=info-label>Livre:</span> <span id=heapFree class=info-value>-- KB</span></div></div></div><div class=info-section><h4>Memória PSRAM (RAM externa)</h4><div class=memory-bar><div class=memory-progress><div id=psramProgressBar class=memory-fill></div></div><div class=memory-text><span id=psramUsage>-- / -- KB (-- %)</span></div></div><div class=info-grid><div class=info-item><span class=info-label>Total:</span> <span id=psramTotal class=info-value>-- KB</span></div><div class=info-item><span class=info-label>Usado:</span> <span id=psramUsed class=info-value>-- KB</span></div><div class=info-item><span class=info-label>Livre:</span> <span id=psramFree class=info-value>-- KB</span></div></div></div><div class=info-section><h4>Memória DMA (Direct Memory Access)</h4><div class=memory-bar><div class=memory-progress><div id=dmaProgressBar class=memory-fill></div></div><div class=memory-text><span id=dmaUsage>-- / -- KB (-- %)</span></div></div><div class=info-grid><div class=info-item><span class=info-label>Total:</span> <span id=dmaTotal class=info-value>-- KB</span></div><div class=info-item><span class=info-label>Usado:</span> <span id=dmaUsed class=info-value>-- KB</span></div><div class=info-item><span class=info-label>Livre:</span> <span id=dmaFree class=info-value>-- KB</span></div></div></div><div class=info-section><h4>Memória IRAM (Instruction RAM)</h4><div class=memory-bar><div class=memory-progress><div id=iramProgressBar class=memory-fill></div></div><div class=memory-text><span id=iramUsage>-- / -- KB (-- %)</span></div></div><div class=info-grid><div class=info-item><span class=info-label>Total:</span> <span id=iramTotal class=info-value>-- KB</span></div><div class=info-item><span class=info-label>Usado:</span> <span id=iramUsed class=info-value>-- KB</span></div><div class=info-item><span class=info-label>Livre:</span> <span id=iramFree class=info-value>-- KB</span></div></div></div><div class=info-section><h4>Memória DRAM (Data RAM)</h4><div class=memory-bar><div class=memory-progress><div id=dramProgressBar class=memory-fill></div></div><div class=memory-text><span id=dramUsage>-- / -- KB (-- %)</span></div></div><div class=info-grid><div class=info-item><span class=info-label>Total:</span> <span id=dramTotal class=info-value>-- KB</span></div><div class=info-item><span class=info-label>Usado:</span> <span id=dramUsed class=info-value>-- KB</span></div><div class=info-item><span class=info-label>Livre:</span> <span id=dramFree class=info-value>-- KB</span></div></div></div><div class=button-group><button id=refreshSystemInfo>Atualizar Informações</button></div></div></div></div></div></div></div></div></body></html>