<!DOCTYPE html><html><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>RC Control</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css><style>body,html{overflow:hidden!important;height:100%;width:100%;margin:0;font-family:Inter,"SF Pro","Segoe UI",Roboto,Oxygen,Ubuntu,"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:large}img{height:80%;width:90%}.speed{align-self:stretch;width:120px;display:flex;align-items:center;justify-content:center}.speed-control{width:80px;height:100%;display:flex;flex-direction:column;align-items:center;position:relative}.speed-track{width:80px;height:100%;background:linear-gradient(to bottom,#f44 0,#f84 20%,#fa4 40%,#4f4 60%,#4af 80%,#44f 100%);border-radius:10px;position:relative;box-shadow:inset 0 2px 8px rgba(0,0,0,.3);border:2px solid #333}.speed-zero-line{position:absolute;top:66.67%;left:-5px;right:-5px;height:3px;background:#000;border-radius:2px;box-shadow:0 0 5px rgba(0,0,0,.5);z-index:2}.speed-indicator{position:absolute;top:66.67%;left:50%;transform:translate(-50%,-50%);width:40px;height:40px;z-index:1;cursor:pointer;transition:top .1s ease-out}.speed-thumb{width:40px;height:40px;background:radial-gradient(circle,#fff 0,#e0e0e0 70%,#999 100%);border:3px solid #333;border-radius:50%;box-shadow:0 4px 12px rgba(0,0,0,.4);display:flex;align-items:center;justify-content:center;position:relative}.speed-thumb:before{content:'';width:8px;height:8px;background:#333;border-radius:50%}.speed-thumb:active{transform:scale(1.1);box-shadow:0 6px 16px rgba(0,0,0,.5)}@media (max-width:768px){.speed{width:100px}.speed-control{width:70px}.speed-indicator{width:35px;height:35px}.speed-thumb{width:35px;height:35px}.speed-value{font-size:14px;padding:6px 10px;min-width:50px}}.speed-control *{user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}.btn{background-color:#0ff;height:70px;width:70px;border:none;border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .3s ease}.btn:hover{transform:scale(1.05);box-shadow:0 4px 8px rgba(0,0,0,.2)}.btn-config{background:linear-gradient(135deg,#667eea 0,#764ba2 100%);color:#fff;font-size:24px}.btn-config:hover{background:linear-gradient(135deg,#5a6fd8 0,#6a4190 100%);transform:scale(1.05) rotate(90deg)}.wheels{background-color:#0800ff;height:80px;width:160px}.view0{position:absolute;top:0;margin:10px;height:calc(100% - 20px);width:calc(100% - 20px)}.view1{position:absolute;top:0;margin:20px;height:calc(100% - 40px);width:calc(100% - 40px);z-index:1000}.cols{display:flex}.colsi{display:flex;flex-direction:row-reverse}.rows{display:flex;flex-direction:column}.grow{flex-grow:1}.gap{gap:10px}.m0{margin:10px}.m1{margin:20px}.w100{width:100%}.h100{height:100%}.wh100{width:100%;height:100%}.end{align-self:flex-end}.space-between{justify-content:space-between}.card{display:flex;flex-direction:column;background-color:#d9dadee8;box-shadow:rgba(9,10,12,.1) 0 8px 16px -2px,rgba(9,10,12,.02) 0 0 0 1px;color:#404654;max-width:100%;position:relative;border-radius:8px}.card-header{height:48px;background-color:#d9dade85;box-shadow:rgba(9,10,12,.1) 0 2px 4px 0;box-sizing:border-box;color:#404654;display:flex;font-size:20px;font-weight:600;padding-left:10px;align-items:center;justify-content:space-between}.card-close-btn{background:0 0;border:none;font-size:24px;color:#404654;cursor:pointer;padding:5px 10px;border-radius:4px;transition:background-color .2s}.card-close-btn:hover{background-color:rgba(64,70,84,.1)}.card-body{display:flex;flex-direction:column;gap:10px;padding:10px;height:100%}input{display:inline-flex;align-items:center;box-shadow:rgba(9,10,12,.05) 0 1px 2px 0 inset;border:1px solid #001adb;border-radius:6px;padding:11px}button{display:flex;align-items:center;justify-content:center;background-color:#00b89c;border:0;box-shadow:rgba(51,51,51,0) 0 1px 2px 0,rgba(51,51,51,0) 0 2px 4px 0;cursor:pointer;height:40px;font-weight:500;padding:16px}.tab-left{display:flex}.tab-left ul{margin:10px;padding:0;display:flex;flex-direction:column;gap:10px}.tab-left li{display:flex;align-items:center;list-style-position:outside;list-style-type:none;list-style-image:none;width:200px;height:30px;background-color:#00f;border-radius:8px;border:1 solid #d9dade85;color:#e3d2d2;font-weight:500;padding:6px}.tab-left>div{flex-grow:1}.tab-item{cursor:pointer;transition:background-color .3s}.tab-item:hover{background-color:#0056b3}.tab-item.active{background-color:#007bff}.tab-content{flex-grow:1;padding:20px}.tab-panel{display:none}.tab-panel.active{display:block}.tab-panel h3{margin-top:0;margin-bottom:20px;color:#404654}.tab-panel label{display:block;margin-bottom:5px;font-weight:500;color:#404654}.tab-panel select{display:inline-flex;align-items:center;box-shadow:rgba(9,10,12,.05) 0 1px 2px 0 inset;border:1px solid #001adb;border-radius:6px;padding:11px;width:100%;margin-bottom:15px}.button-group{margin-top:20px;display:flex;gap:10px}.status-info{background-color:#f8f9fa;border:1px solid #dee2e6;border-radius:6px;padding:15px;margin-bottom:20px;font-family:monospace;font-size:14px}.progress-container{margin-top:20px}.progress-bar{width:100%;height:20px;background-color:#e9ecef;border-radius:10px;overflow:hidden}.progress-fill{height:100%;background-color:#28a745;width:0%;transition:width .3s ease}.progress-container #progressText{text-align:center;margin-top:10px;font-weight:500}</style><script>let DEBUG=!1;function makeView(){document.getElementsByTagName("img")[0].src="/video?"+(new Date).getTime()}let ws=null;function initWebSocket(){if(DEBUG)console.log("DEBUG mode: WebSocket disabled for testing");else try{(ws=new WebSocket(`ws://${window.location.host}/ws`)).onopen=()=>{console.log("WebSocket connected for control commands")},ws.onclose=()=>{console.log("WebSocket closed"),setTimeout(initWebSocket,3e3)},ws.onerror=e=>{console.error("WebSocket error:",e)}}catch(e){console.error("Failed to initialize WebSocket:",e)}}function sendSpeedCommand(e){var t;DEBUG?console.log("DEBUG mode: Speed command (visual test only):",e):ws&&ws.readyState===WebSocket.OPEN?(t={type:"speed",value:e},ws.send(JSON.stringify(t)),console.log("Speed command sent:",e)):console.warn("WebSocket not connected, cannot send speed command:",e)}function initSpeedControl(){let r=document.getElementById("speedIndicator");if(r){let o=r.parentElement,n=!1,i=0,s=0,a=66.67;function l(e){var t;e=Math.max(0,Math.min(100,e)),r.style.top=e+"%",e=e,t=(a-e)/a,sendSpeedCommand(e<a?Math.round(100*t):(t=100-a,e=(e-a)/t,Math.round(100*-e)))}function e(){r.style.transition="top 0.3s ease-out",l(a),setTimeout(()=>{r.style.transition="top 0.1s ease-out"},300)}r.addEventListener("mousedown",e=>{n=!0,i=e.clientY,s=parseFloat(r.style.top)||a,r.style.transition="none",e.preventDefault()}),document.addEventListener("mousemove",e=>{var t;n&&(t=(e.clientY-i)/o.clientHeight*100,l(s+t),e.preventDefault())}),document.addEventListener("mouseup",()=>{n&&(n=!1,e())}),r.addEventListener("touchstart",e=>{n=!0,i=e.touches[0].clientY,s=parseFloat(r.style.top)||a,r.style.transition="none",e.preventDefault()}),document.addEventListener("touchmove",e=>{var t;n&&(t=(e.touches[0].clientY-i)/o.clientHeight*100,l(s+t),e.preventDefault())}),document.addEventListener("touchend",()=>{n&&(n=!1,e())}),l(a)}else console.error("Speed control elements not found. Retrying in 100ms..."),setTimeout(initSpeedControl,100)}class ViewInst{constructor(e,t){this.parentCtx=t,this.html=e.cloneNode(!0),this.ctx={},this.setupCloseButtons()}setupCloseButtons(){this.html.querySelectorAll('[data-close-view="true"]').forEach(e=>{e.addEventListener("click",()=>{this.close()})})}setOnclick(e,t){this.html.querySelector("#"+e).onclick=t}close(){document.body.removeChild(this.html)}}class View{constructor(e,t){this.ctr=t,this.template=document.getElementById(e),document.body.removeChild(this.template)}show(e){e=new ViewInst(this.template,e);return this.ctr&&this.ctr(e),document.body.appendChild(e.html),e}}function mainCtr(e){setTimeout(()=>{initSpeedControl()},0),e.setOnclick("btnConfiguration",()=>{views.configurationView.show()})}function netCtr(e){let o=e.html.querySelectorAll(".tab-item"),n=e.html.querySelectorAll(".tab-panel");o.forEach(t=>{t.addEventListener("click",()=>{o.forEach(e=>e.classList.remove("active")),n.forEach(e=>e.classList.remove("active")),t.classList.add("active");var e=t.id.replace("tab","tab")+"Content";document.getElementById(e).classList.add("active")})}),e.html.querySelector("#tabOTA").addEventListener("click",loadOTAStatus),e.html.querySelector("#saveWifiConfig").addEventListener("click",saveWifiConfig),e.html.querySelector("#uploadOTA").addEventListener("click",uploadOTAFirmware)}async function loadOTAStatus(){try{var e=await(await fetch("/ota/status")).json();document.getElementById("otaStatus").innerHTML=`
            <strong>Partição em execução:</strong> ${e.running_partition}<br>
            <strong>Partição de boot:</strong> ${e.boot_partition}<br>
            <strong>OTA em progresso:</strong> ${e.ota_in_progress?"Sim":"Não"}
        `}catch(e){console.error("Erro ao carregar status OTA:",e),document.getElementById("otaStatus").innerHTML="Erro ao carregar informações do sistema."}}function saveWifiConfig(){var e=document.getElementById("wifiSsid").value,t=document.getElementById("wifiPassword").value;e?(alert("Configuração WiFi salva com sucesso!"),console.log("WiFi Config:",{ssid:e,password:t})):alert("Por favor, insira o nome da rede WiFi")}async function uploadOTAFirmware(){let s=document.getElementById("otaFile");var a=s.files[0];if(a)if(a.name.endsWith(".bin")){let t=document.getElementById("otaProgress"),o=document.getElementById("progressBar"),n=document.getElementById("progressText"),i=document.getElementById("uploadOTA");t.style.display="block",i.disabled=!0,i.textContent="Enviando...";try{(new FormData).append("firmware",a);let e=new XMLHttpRequest;e.upload.addEventListener("progress",e=>{e.lengthComputable&&(e=e.loaded/e.total*100,o.style.width=e+"%",n.textContent=Math.round(e)+"%")}),e.onload=function(){if(200===e.status)try{JSON.parse(e.responseText);alert("Firmware enviado com sucesso! O dispositivo será reiniciado."),s.value="",t.style.display="none"}catch(e){alert("Firmware enviado com sucesso! O dispositivo será reiniciado.")}else alert("Erro no upload: "+e.responseText);i.disabled=!1,i.textContent="Atualizar Firmware",t.style.display="none"},e.onerror=function(){alert("Erro na conexão durante o upload"),i.disabled=!1,i.textContent="Atualizar Firmware",t.style.display="none"},e.open("POST","/ota/upload"),e.send(a)}catch(e){console.error("Erro no upload OTA:",e),alert("Erro ao enviar firmware"),i.disabled=!1,i.textContent="Atualizar Firmware",t.style.display="none"}}else alert("Por favor, selecione um arquivo .bin válido");else alert("Por favor, selecione um arquivo .bin")}let views={};function main(){DEBUG?console.log("DEBUG mode enabled: Running in visual test mode without WebSocket"):initWebSocket(),views.mainView=new View("mainView",mainCtr),views.configurationView=new View("configurationView",netCtr),views.mainView.show()}window.onload=main</script></head><body><div id=mainView class="gap cols view0"><div class=speed><div class=speed-control><div class=speed-track><div class=speed-zero-line></div><div class=speed-indicator id=speedIndicator><div class=speed-thumb></div></div></div></div></div><div class="gap space-between grow rows"><div class="gap cols space-between"><div class="gap cols"><div class=btn></div><div class=btn></div></div><div id=btnConfiguration class="btn btn-config"><i class="fa-2x fa-cog fas"></i></div></div><div class=colsi><div class=wheels></div></div></div></div><div id=configurationView class="panel view1"><div class="card wh100"><header class=card-header><span>Configuração</span> <button class=card-close-btn data-close-view=true>✕</button></header><div class=card-body><div class=tab-left><ul><li id=tabGeneral class="tab-item active">General</li><li id=tabWifi class=tab-item>Wifi</li><li id=tabOTA class=tab-item>OTA</li></ul><div class=tab-content><div id=tabGeneralContent class="tab-panel active"><h3>Configuração Geral</h3><label>Tipo de Conexão:</label> <select id=connectionType><option value=wifi>WiFi</option><option value=bluetooth>Bluetooth</option></select></div><div id=tabWifiContent class=tab-panel><h3>Configuração WiFi</h3><label>Nome do WiFi (SSID):</label> <input id=wifiSsid type=text placeholder="Nome da rede WiFi"> <label>Senha do WiFi:</label> <input id=wifiPassword type=password placeholder="Senha da rede WiFi"><div class=button-group><button id=saveWifiConfig>Gravar</button></div></div><div id=tabOTAContent class=tab-panel><h3>Atualização OTA</h3><div id=otaStatus class=status-info>Carregando informações...</div><label>Selecionar arquivo .bin:</label> <input id=otaFile type=file accept=.bin><div class=button-group><button id=uploadOTA>Atualizar Firmware</button></div><div id=otaProgress class=progress-container style=display:none><div class=progress-bar><div id=progressBar class=progress-fill></div></div><div id=progressText>0%</div></div></div></div></div></div></div></div></body></html>