<!DOCTYPE html><html><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>RC Control</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css><style>body,html{overflow:hidden!important;height:100%;width:100%;margin:0;font-family:Inter,"SF Pro","Segoe UI",Roboto,Oxygen,Ubuntu,"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:large}img{height:80%;width:90%}.control{display:flex;align-items:center;justify-content:center}.control-track{border-radius:10px;position:relative;box-shadow:inset 0 2px 8px rgba(0,0,0,.3);border:2px solid #333;cursor:pointer}.control-zero-line{position:absolute;background:#000;border-radius:2px;box-shadow:0 0 5px rgba(0,0,0,.5);z-index:2}.control-indicator{position:absolute;z-index:1;cursor:pointer;transition:top .1s ease-out}.control-thumb{background:radial-gradient(circle,#fff 0,#e0e0e0 70%,#999 100%);border:3px solid #333;border-radius:50%;box-shadow:0 4px 12px rgba(0,0,0,.4);display:flex;align-items:center;justify-content:center;position:relative}.control-thumb:before{content:'';width:8px;height:8px;background:#333;border-radius:50%}.control-thumb:active{transform:scale(1.1);box-shadow:0 6px 16px rgba(0,0,0,.5)}.control *{user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}.speed{align-self:stretch;width:120px}.speed-control{width:80px;height:100%;display:flex;flex-direction:column;align-items:center;position:relative}.speed-track{width:80px;height:100%;background:linear-gradient(to bottom,#f44 0,#f84 20%,#fa4 40%,#4f4 60%,#4af 80%,#44f 100%)}.speed-zero-line{top:66.67%;left:-5px;right:-5px;height:3px}.speed-indicator{top:66.67%;left:50%;transform:translate(-50%,-50%);width:90px;height:20px}.speed-thumb{width:87px;height:18px}.wheels{align-self:stretch;height:80px;width:240px;display:flex;align-items:center;justify-content:center}.wheels-control{width:100%;height:50px;display:flex;flex-direction:row;align-items:center;position:relative}.wheels-track{width:100%;height:50px;background:linear-gradient(to right,#f44 0,#f84 20%,#fa4 40%,#4f4 50%,#4af 60%,#48f 80%,#44f 100%)}.wheels-zero-line{left:50%;top:-5px;bottom:-5px;width:3px}.wheels-indicator{left:50%;top:50%;transform:translate(-50%,-50%);width:20px;height:60px;transition:left .1s ease-out}.wheels-thumb{width:18px;height:57px}.btn{background-color:#0ff;height:70px;width:70px;border:none;border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .3s ease}.btn:hover{transform:scale(1.05);box-shadow:0 4px 8px rgba(0,0,0,.2)}.btn-config{background:linear-gradient(135deg,#667eea 0,#764ba2 100%);color:#fff;font-size:24px}.btn-config:hover{background:linear-gradient(135deg,#5a6fd8 0,#6a4190 100%);transform:scale(1.05) rotate(90deg)}.btn-horn{background:linear-gradient(135deg,#ff6b6b 0,#ee5a24 100%);color:#fff;font-size:24px;box-shadow:0 4px 8px rgba(255,107,107,.3)}.btn-horn:hover{background:linear-gradient(135deg,#ff5252 0,#d63031 100%);transform:scale(1.1);box-shadow:0 6px 12px rgba(255,107,107,.4)}.btn-horn.active{transform:scale(.95);box-shadow:0 0 20px rgba(255,107,107,.8),0 0 40px rgba(255,107,107,.4)}.btn-light{background:linear-gradient(135deg,#6c757d 0,#495057 100%);color:#adb5bd;font-size:24px;box-shadow:0 4px 8px rgba(108,117,125,.3);transition:all .3s ease}.btn-light:hover{background:linear-gradient(135deg,#6c757d 0,#495057 100%);color:#adb5bd;box-shadow:0 4px 8px rgba(108,117,125,.3)}.btn-light.active{background:linear-gradient(135deg,#ffc107 0,#ffca2c 100%)!important;color:#212529!important;box-shadow:0 0 20px rgba(255,193,7,.8),0 0 40px rgba(255,193,7,.4)!important}.view0{position:absolute;top:0;margin:5px;height:calc(100% - 20px);width:calc(100% - 20px)}.view1{position:absolute;top:0;margin:10px;height:calc(100% - 40px);width:calc(100% - 40px);z-index:1000}.cols{display:flex}.colsi{display:flex;flex-direction:row-reverse}.rows{display:flex;flex-direction:column}.grow{flex-grow:1}.gap{gap:10px}.m0{margin:10px}.m1{margin:20px}.w100{width:100%}.h100{height:100%}.wh100{width:100%;height:100%}.end{align-self:flex-end}.space-between{justify-content:space-between}.card{display:flex;flex-direction:column;background-color:#d9dadee8;box-shadow:rgba(9,10,12,.1) 0 8px 16px -2px,rgba(9,10,12,.02) 0 0 0 1px;color:#404654;max-width:100%;position:relative;border-radius:8px}.card-header{height:48px;background-color:#d9dade85;box-shadow:rgba(9,10,12,.1) 0 2px 4px 0;box-sizing:border-box;color:#404654;display:flex;font-size:20px;font-weight:600;padding-left:10px;align-items:center;justify-content:space-between}.card-close-btn{background:0 0;border:none;font-size:24px;color:#404654;cursor:pointer;padding:5px 10px;border-radius:4px;transition:background-color .2s}.card-close-btn:hover{background-color:rgba(64,70,84,.1)}.card-body{display:flex;flex-direction:column;gap:10px;padding:10px;height:100%}input{display:inline-flex;align-items:center;box-shadow:rgba(9,10,12,.05) 0 1px 2px 0 inset;border:1px solid #001adb;border-radius:6px;padding:11px}button{display:flex;align-items:center;justify-content:center;background-color:#00b89c;border:0;box-shadow:rgba(51,51,51,0) 0 1px 2px 0,rgba(51,51,51,0) 0 2px 4px 0;cursor:pointer;height:40px;font-weight:500;padding:16px}.tab-left{display:flex}.tab-left ul{margin:5px;padding:0;display:flex;flex-direction:column;gap:5px;min-width:120px;width:120px}.tab-left li{display:flex;align-items:center;justify-content:center;list-style-position:outside;list-style-type:none;list-style-image:none;width:100%;height:24px;background-color:#00f;border-radius:6px;border:1px solid #d9dade85;color:#e3d2d2;font-weight:500;font-size:14px;padding:4px 8px}.tab-left>div{flex-grow:1}.tab-item{cursor:pointer;transition:background-color .3s}.tab-item:hover{background-color:#0056b3}.tab-item.active{background-color:#007bff}.tab-content{flex-grow:1;padding:15px;overflow-y:auto;max-height:calc(100vh - 120px)}.tab-panel{display:none}.tab-panel.active{display:block}.tab-panel h3{margin-top:0;margin-bottom:20px;color:#404654}.tab-panel label{display:block;margin-bottom:5px;font-weight:500;color:#404654}.tab-panel select{display:inline-flex;align-items:center;box-shadow:rgba(9,10,12,.05) 0 1px 2px 0 inset;border:1px solid #001adb;border-radius:6px;padding:11px;width:100%;margin-bottom:15px}.button-group{margin-top:20px;display:flex;gap:10px}.status-info{background-color:#f8f9fa;border:1px solid #dee2e6;border-radius:6px;padding:15px;margin-bottom:20px;font-family:monospace;font-size:14px}.progress-container{margin-top:20px}.progress-bar{width:100%;height:20px;background-color:#e9ecef;border-radius:10px;overflow:hidden}.progress-fill{height:100%;background-color:#28a745;width:0%;transition:width .3s ease}.progress-container #progressText{text-align:center;margin-top:10px;font-weight:500}.system-info{font-size:14px}.info-section{margin-bottom:25px;border:1px solid #dee2e6;border-radius:8px;padding:15px;background-color:#f8f9fa}.info-section h4{margin:0 0 15px 0;color:#495057;font-size:16px;font-weight:600;border-bottom:1px solid #dee2e6;padding-bottom:8px}.info-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px}.info-item{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background-color:#fff;border-radius:4px;border:1px solid #e9ecef}.info-label{font-weight:500;color:#6c757d}.info-value{font-weight:600;color:#212529;font-family:monospace}.memory-bar{margin-bottom:15px}.memory-progress{width:100%;height:24px;background-color:#e9ecef;border-radius:12px;overflow:hidden;margin-bottom:8px}.memory-fill{height:100%;background:linear-gradient(90deg,#28a745 0,#ffc107 70%,#dc3545 90%);width:0%;transition:width .5s ease}.memory-text{text-align:center;font-weight:600;color:#495057;font-family:monospace;font-size:13px}.system-info .button-group{justify-content:center}.battery-indicator{display:flex;align-items:center;justify-content:center;width:70px;height:70px;position:relative}.battery-body{width:60px;height:40px;background:#333;border:2px solid #666;border-radius:3px;position:relative;display:flex;flex-direction:row;justify-content:space-between;align-items:center;padding:2px 4px;box-sizing:border-box}.battery-tip{width:8px;height:24px;background:#666;border-radius:0 2px 2px 0;position:absolute;right:-3px;top:50%;transform:translateY(-50%)}.battery-level{width:4px;height:32px;background:#111;border-radius:1px;margin:0 1px;transition:background-color .3s ease}.battery-level.active.level-1,.battery-level.active.level-2,.battery-level.active.level-3{background:#dc3545}.battery-level.active.level-4,.battery-level.active.level-5,.battery-level.active.level-6,.battery-level.active.level-7{background:#ffc107}.battery-level.active.level-10,.battery-level.active.level-8,.battery-level.active.level-9{background:#28a745}</style><script>let DEBUG=!1;class RCPClient{constructor(e){this.ws=e,this.RCP_SYNC_BYTE=170,this.RCP_PORTS={MOTOR:1,SERVO:2,HORN:3,LIGHT:4,SYSTEM:16,CONFIG:17,STATUS:18,BATTERY:128,TELEMETRY:129,ACK:255},this.RCP_SYS_COMMANDS={PING:1,RESET:2,STATUS:3,CONFIG:4},this.stats={commandsSent:0,responsesReceived:0,errors:0},console.log("RCP Client v1.0 initialized")}calculateChecksum(t){var n=new Uint8Array([0,7,14,9,28,27,18,21,56,63,54,49,36,35,42,45,112,119,126,121,108,107,98,101,72,79,70,65,84,83,90,93,224,231,238,233,252,251,242,245,216,223,214,209,196,195,202,205,144,151,158,153,140,139,130,133,168,175,166,161,180,179,186,189,199,192,201,206,219,220,213,210,255,248,241,246,227,228,237,234,183,176,185,190,171,172,165,162,143,136,129,134,147,148,157,154,39,32,41,46,59,60,53,50,31,24,17,22,3,4,13,10,87,80,89,94,75,76,69,66,111,104,97,102,115,116,125,122,137,142,135,128,149,146,155,156,177,182,191,184,173,170,163,164,249,254,247,240,229,226,235,236,193,198,207,200,221,218,211,212,105,110,103,96,117,114,123,124,81,86,95,88,77,74,67,68,25,30,23,16,5,2,11,12,33,38,47,40,61,58,51,52,78,73,64,71,82,85,92,91,118,113,120,127,106,109,100,99,62,57,48,55,34,37,44,43,6,1,8,15,26,29,20,19,174,169,160,167,178,181,188,187,150,145,152,159,138,141,132,131,222,217,208,215,194,197,204,203,230,225,232,239,250,253,244,243]);let o=this.RCP_SYNC_BYTE;for(let e=0;e<t.length-1;e++)o=n[o^t[e]];return o}validateChecksum(e){return!(e.length<3)&&e[e.length-1]===this.calculateChecksum(e)}validateCommand(e,t){return"number"!=typeof e||e<0||255<e?(console.error("RCP: Invalid port:",e),!1):t instanceof Uint8Array?14<t.length?(console.error("RCP: Payload too large:",t.length),!1):e===this.RCP_PORTS.SYSTEM&&2!==t.length?(console.error("RCP: System command requires 2 bytes payload (command + param), got:",t.length),!1):e===this.RCP_PORTS.MOTOR&&1!==t.length?(console.error("RCP: Motor command requires 1 byte payload, got:",t.length),!1):e===this.RCP_PORTS.SERVO&&1!==t.length?(console.error("RCP: Servo command requires 1 byte payload, got:",t.length),!1):e!==this.RCP_PORTS.HORN&&e!==this.RCP_PORTS.LIGHT||1===t.length||(console.error("RCP: Horn/Light command requires 1 byte payload, got:",t.length),!1):(console.error("RCP: Payload is not Uint8Array:",t),!1)}sendCommand(e,t=new Uint8Array(0)){if(!this.validateCommand(e,t))return this.stats.errors++,!1;if(!this.ws||this.ws.readyState!==WebSocket.OPEN)return console.warn("RCP: WebSocket not connected"),this.stats.errors++,!1;var n=2+t.length+1,o=new ArrayBuffer(n),r=new Uint8Array(o);if(r[0]=this.RCP_SYNC_BYTE,r[1]=e,0<t.length&&r.set(t,2),r[n-1]=this.calculateChecksum(r),!this.ws)return console.warn("RCP: WebSocket instance is null"),this.stats.errors++,!1;if(this.ws.readyState!==WebSocket.OPEN)return console.warn("RCP: WebSocket not ready for sending (readyState:",this.ws.readyState,"expected:",WebSocket.OPEN,")"),this.stats.errors++,!1;if("arraybuffer"!==this.ws.binaryType)return console.error("RCP: WebSocket binaryType is not arraybuffer:",this.ws.binaryType),this.stats.errors++,!1;try{if(!(o instanceof ArrayBuffer))throw new Error("Buffer is not an ArrayBuffer instance");if(0===o.byteLength)throw new Error("Buffer is empty");this.ws.send(o),this.stats.commandsSent++,DEBUG&&(console.log(`RCP: Sent command port=0x${e.toString(16).padStart(2,"0").toUpperCase()}, size=${n} bytes`),s=new Uint8Array(o),console.log("RCP: Buffer contents:",Array.from(s).map(e=>"0x"+e.toString(16).padStart(2,"0")).join(" ")),a=this.calculateChecksum(s),i=s[s.length-1],console.log("RCP: Checksum validation - Expected:",a,"Actual:",i,"Valid:",a===i));var s,a,i,c=new Uint8Array(o);return c[0]!==this.RCP_SYNC_BYTE&&console.error("RCP: CRITICAL - Sync byte incorrect!",c[0],"expected:",this.RCP_SYNC_BYTE),c[1]!==e&&console.error("RCP: CRITICAL - Port byte incorrect!",c[1],"expected:",e),!0}catch(e){return console.error("RCP: Failed to send command:",e),console.error("RCP: WebSocket state at error:",{readyState:this.ws.readyState,binaryType:this.ws.binaryType,url:this.ws.url}),this.stats.errors++,!1}}sendMotorCommand(e){e=Math.max(-100,Math.min(100,Math.round(e)));var t=new Uint8Array(1);return t[0]=e,DEBUG&&console.log("RCP: Sending motor command: speed="+e),this.sendCommand(this.RCP_PORTS.MOTOR,t)}sendServoCommand(e){e=Math.max(-100,Math.min(100,Math.round(e)));var t=new Uint8Array(1);return t[0]=e,DEBUG&&console.log("RCP: Sending servo command: angle="+e),this.sendCommand(this.RCP_PORTS.SERVO,t)}sendHornCommand(e){var t=new Uint8Array(1);return t[0]=e?1:0,DEBUG&&console.log("RCP: Sending horn command: "+(e?"ON":"OFF")),this.sendCommand(this.RCP_PORTS.HORN,t)}sendLightCommand(e){var t=new Uint8Array(1);return t[0]=e?1:0,DEBUG&&console.log("RCP: Sending light command: "+(e?"ON":"OFF")),this.sendCommand(this.RCP_PORTS.LIGHT,t)}processResponse(e){var t=new DataView(e),n=new Uint8Array(e);if(e.byteLength<3)console.warn("RCP: Response too short"),this.stats.errors++;else{var e=t.getUint8(0),o=t.getUint8(1);if(e!==this.RCP_SYNC_BYTE)console.warn(`RCP: Invalid sync byte 0x${e.toString(16)} (expected 0x${this.RCP_SYNC_BYTE.toString(16)})`),this.stats.errors++;else if(this.validateChecksum(n))switch(this.stats.responsesReceived++,o){case this.RCP_PORTS.BATTERY:this.processBatteryResponse(t,n);break;case this.RCP_PORTS.TELEMETRY:this.processTelemetryResponse(t,n);break;case this.RCP_PORTS.ACK:DEBUG&&console.log("RCP: Acknowledgment received");break;default:console.warn("RCP: Unknown response port 0x"+o.toString(16)),this.stats.errors++}else console.warn("RCP: Response checksum mismatch"),this.stats.errors++}}processBatteryResponse(e,t){var n;7!==t.length?(console.warn("RCP: Invalid battery response size"),this.stats.errors++):(t=e.getUint16(2,!0),n=e.getUint8(4),e=e.getUint8(5),t/=1e3,DEBUG&&console.log(`RCP: Battery status - ${t.toFixed(2)}V, Level: ${n}/10, Type: ${e}S`),updateBatteryLevel(n),batteryType=e+"S")}processTelemetryResponse(e,t){var n,o,r;8!==t.length?(console.warn("RCP: Invalid telemetry response size"),this.stats.errors++):(t=e.getInt8(2),n=e.getInt8(3),o=e.getUint8(4),r=e.getUint8(5),e=e.getUint8(6),DEBUG&&console.log(`RCP: Telemetry - Speed: ${t}, Angle: ${n}, Horn: ${o?"ON":"OFF"}, Light: ${r?"ON":"OFF"}, Flags: 0x`+e.toString(16)))}getStats(){return{...this.stats}}resetStats(){this.stats.commandsSent=0,this.stats.responsesReceived=0,this.stats.errors=0}}function makeView(){document.getElementsByTagName("img")[0].src="/video?"+(new Date).getTime()}let ws=null,rcpClient=null,batteryType="1S",wsReconnectAttempts=0,maxReconnectAttempts=100,reconnectInterval=3e3,lastSpeedValue=null,lastWheelsValue=null,lastHornValue=null,lastLightValue=null,speedCommandTimeout=null,wheelsCommandTimeout=null,COMMAND_THROTTLE_MS=50,activeControls=new Set;function setControlActive(e,t){t?activeControls.add(e):activeControls.delete(e),DEBUG&&activeControls.size}function resetCommandCache(){lastSpeedValue=null,lastWheelsValue=null,lastHornValue=null,lastLightValue=null,speedCommandTimeout&&(clearTimeout(speedCommandTimeout),speedCommandTimeout=null),wheelsCommandTimeout&&(clearTimeout(wheelsCommandTimeout),wheelsCommandTimeout=null),rcpClient&&rcpClient.resetStats(),console.log("Command cache reset - next commands will be sent regardless of previous values")}function showRCPStats(){var e;return rcpClient?(e=rcpClient.getStats(),console.log("=== RCP Protocol Statistics ==="),console.log("Commands Sent: "+e.commandsSent),console.log("Responses Received: "+e.responsesReceived),console.log("Errors: "+e.errors),console.log(`Success Rate: ${0<e.commandsSent?((e.commandsSent-e.errors)/e.commandsSent*100).toFixed(1):0}%`),console.log("=============================="),e):(console.log("RCP Client not initialized"),null)}function checkWebSocketHealth(){var e;return ws?(e={readyState:ws.readyState,readyStateText:["CONNECTING","OPEN","CLOSING","CLOSED"][ws.readyState],binaryType:ws.binaryType,url:ws.url,protocol:ws.protocol,extensions:ws.extensions},console.log("WebSocket Health Check:",e),ws.readyState!==WebSocket.OPEN?(console.warn("WebSocket Health: Connection not OPEN"),!1):"arraybuffer"===ws.binaryType||(console.error("WebSocket Health: Binary type is not arraybuffer!"),!1)):(console.warn("WebSocket Health: No WebSocket instance"),!1)}function testWebSocketConnectivity(){if(!checkWebSocketHealth())return console.error("WebSocket health check failed - skipping connectivity test"),!1;if(!rcpClient)return console.warn("RCP Client not initialized - skipping connectivity test"),!1;try{console.log("Testing WebSocket connectivity with RCP ping...");var e=rcpClient.sendCommand(rcpClient.RCP_PORTS.SYSTEM,new Uint8Array([rcpClient.RCP_SYS_COMMANDS.PING,0]));return e?console.log("WebSocket connectivity test: PASSED"):console.error("WebSocket connectivity test: FAILED"),e}catch(e){return console.error("WebSocket connectivity test error:",e),!1}}function runWebSocketDiagnostics(){console.log("=== WebSocket Diagnostics ===");var e=checkWebSocketHealth();if(console.log("Health Check:",e?"PASS":"FAIL"),!rcpClient)return console.error("RCP Client: NOT INITIALIZED"),!1;console.log("RCP Client: OK");var t=testWebSocketConnectivity(),n=(console.log("Connectivity Test:",t?"PASS":"FAIL"),showRCPStats(),console.log("Testing different RCP commands..."),rcpClient.sendCommand(rcpClient.RCP_PORTS.MOTOR,new Uint8Array([0]))),n=(console.log("Motor Command Test:",n?"PASS":"FAIL"),rcpClient.sendCommand(rcpClient.RCP_PORTS.SERVO,new Uint8Array([0]))),n=(console.log("Servo Command Test:",n?"PASS":"FAIL"),rcpClient.sendCommand(rcpClient.RCP_PORTS.HORN,new Uint8Array([0]))),n=(console.log("Horn Command Test:",n?"PASS":"FAIL"),rcpClient.sendCommand(rcpClient.RCP_PORTS.LIGHT,new Uint8Array([0])));return console.log("Light Command Test:",n?"PASS":"FAIL"),console.log("=== Diagnostics Complete ==="),e&&t}function initWebSocket(){if(!DEBUG)try{ws&&ws.readyState!==WebSocket.CLOSED&&ws.close();var e=`ws://${window.location.host}/ws`;if(console.log("Connecting to WebSocket:",e),!(ws=new WebSocket(e)))throw new Error("Failed to create WebSocket instance");if(ws.binaryType="arraybuffer",Object.defineProperty(ws,"binaryType",{value:"arraybuffer",writable:!1,enumerable:!0,configurable:!1}),console.log("WebSocket created - binaryType:",ws.binaryType,"readyState:",ws.readyState),"arraybuffer"!==ws.binaryType)throw console.error("CRITICAL: WebSocket binaryType could not be set to arraybuffer!"),new Error("WebSocket configuration failed");let t=setTimeout(()=>{ws.readyState===WebSocket.CONNECTING&&(console.warn("WebSocket connection timeout, closing..."),ws.close())},5e3);ws.onopen=()=>{clearTimeout(t),console.log("WebSocket connected for control commands"),wsReconnectAttempts=0,reconnectInterval=3e3,console.log("WebSocket post-connection check:",{readyState:ws.readyState,binaryType:ws.binaryType,url:ws.url}),"arraybuffer"!==ws.binaryType&&(console.warn("WebSocket binaryType was reset - fixing..."),ws.binaryType="arraybuffer"),rcpClient=new RCPClient(ws),console.log("RCP Client initialized and ready"),resetCommandCache(),setTimeout(()=>{testWebSocketConnectivity()},1e3)},ws.onmessage=t=>{try{t.data instanceof ArrayBuffer?(DEBUG&&console.log(`Received binary frame (${t.data.byteLength} bytes)`),rcpClient&&rcpClient.processResponse(t.data)):t.data instanceof Blob&&t.data.arrayBuffer().then(e=>{if(3<=e.byteLength&&170===new Uint8Array(e)[0])return void(rcpClient&&rcpClient.processResponse(e));ws&&ws.readyState===WebSocket.OPEN&&ws.pong&&ws.pong()})}catch(e){console.error("Error handling WebSocket message:",e),console.error("Message type:",typeof t.data,"Data:",t.data)}},ws.onerror=e=>{console.error("WebSocket error occurred:",e),console.error("WebSocket state:",{readyState:ws.readyState,binaryType:ws.binaryType,url:ws.url,protocol:ws.protocol,extensions:ws.extensions}),console.error("Error context:",{wsReconnectAttempts:wsReconnectAttempts,maxReconnectAttempts:maxReconnectAttempts,reconnectInterval:reconnectInterval,activeControls:Array.from(activeControls),rcpClientExists:!!rcpClient}),rcpClient=null},ws.onclose=e=>{clearTimeout(t),console.log("WebSocket connection closed:",{code:e.code,reason:e.reason,wasClean:e.wasClean,readyState:ws.readyState}),rcpClient=null,1e3!==e.code&&wsReconnectAttempts<maxReconnectAttempts?(wsReconnectAttempts++,e=1e3*Math.random(),e=Math.min(reconnectInterval*Math.pow(1.5,wsReconnectAttempts-1)+e,3e4),console.warn(`WebSocket disconnected (attempt ${wsReconnectAttempts}/${maxReconnectAttempts}), reconnecting in ${Math.round(e/1e3)}s...`),setTimeout(initWebSocket,e)):wsReconnectAttempts>=maxReconnectAttempts&&console.error("WebSocket max reconnection attempts reached. Please refresh the page.")},ws.onerror=e=>{clearTimeout(t),console.error("WebSocket error:",e)}}catch(e){console.error("Failed to initialize WebSocket:",e),wsReconnectAttempts<maxReconnectAttempts&&(wsReconnectAttempts++,setTimeout(initWebSocket,reconnectInterval))}}function calculateBatteryLevel(e,t){let n,o;if("1S"===t)n=3,o=4.2;else{if("2S"!==t)return console.error("Unknown battery type:",t),0;n=6,o=8.4}t=Math.max(0,Math.min(100,(e-n)/(o-n)*100)),e=Math.floor(t/10);return Math.max(0,Math.min(10,e))}function sendSpeedCommand(e){speedCommandTimeout&&clearTimeout(speedCommandTimeout),speedCommandTimeout=setTimeout(()=>{lastSpeedValue!==e&&(sendControlCommand("speed",e),lastSpeedValue=e),speedCommandTimeout=null},COMMAND_THROTTLE_MS)}function sendWheelsCommand(e){wheelsCommandTimeout&&clearTimeout(wheelsCommandTimeout),wheelsCommandTimeout=setTimeout(()=>{lastWheelsValue!==e&&(sendControlCommand("wheels",e),lastWheelsValue=e),wheelsCommandTimeout=null},COMMAND_THROTTLE_MS)}function sendControlCommand(e,t){if("number"!=typeof t||isNaN(t))console.error(`Invalid ${e} command value:`,t);else if("speed"!==e&&"wheels"!==e||(t=Math.max(-100,Math.min(100,t))),DEBUG)console.log(`DEBUG mode: ${e} command (visual test only):`,t);else if(ws&&ws.readyState===WebSocket.OPEN&&rcpClient)switch(e){case"speed":rcpClient.sendMotorCommand(t);break;case"wheels":rcpClient.sendServoCommand(t);break;case"horn":rcpClient.sendHornCommand(t);break;case"light":rcpClient.sendLightCommand(t);break;default:return void console.warn("Unknown RCP command type: "+e)}else console.warn(`WebSocket not connected or RCP client not available, cannot send ${e} command:`,t),ws&&ws.readyState!==WebSocket.CLOSED||initWebSocket()}function sendHornCommand(e){var t=e?1:0;lastHornValue!==t&&(DEBUG?(console.log("DEBUG mode: Horn command (visual test only):",e),lastHornValue=t):ws&&ws.readyState===WebSocket.OPEN&&rcpClient?(rcpClient.sendHornCommand(e),lastHornValue=t):console.warn("WebSocket not connected or RCP client not available, cannot send horn command:",e))}function sendLightCommand(e){var t=e?1:0;lastLightValue!==t&&(DEBUG?(console.log("DEBUG mode: Light command (visual test only):",e),lastLightValue=t):ws&&ws.readyState===WebSocket.OPEN&&rcpClient?(rcpClient.sendLightCommand(e),lastLightValue=t):console.warn("WebSocket not connected or RCP client not available, cannot send light command:",e))}function initGenericControl(u,n){let h=document.getElementById(u+"Indicator");if(h){let a=h.parentElement,i="speed"===u,c=i?66.67:50,l=[],d=0,m=0,o=!1,r={x:0,y:0},s=0;function p(e){e=Math.max(0,Math.min(100,e)),i?h.style.top=e+"%":h.style.left=e+"%";e=e;var t=i?(t=(c-e)/c,e<c?Math.round(100*t):(t=100-c,t=(e-c)/t,Math.round(100*-t))):Math.round(2*(e-50));n(t)}function y(){var e;i?(e=parseFloat(h.style.top)||c,(e=Math.abs(e-c))<=10?(DEBUG&&console.log(`${u}: Dentro da zona de reset (${e.toFixed(1)}%), retornando ao zero`),h.style.transition="top 0.3s ease-out",p(c),setTimeout(()=>{h.style.transition="top 0.1s ease-out"},300)):(DEBUG&&console.log(`${u}: Fora da zona de reset (${e.toFixed(1)}%), mantendo posição atual`),h.style.transition="top 0.1s ease-out")):(DEBUG&&console.log(u+": Retornando ao centro (comportamento wheels)"),h.style.transition="left 0.3s ease-out",p(c),setTimeout(()=>{h.style.transition="left 0.1s ease-out"},300))}function C(t){for(let e=0;e<l.length;e++)if(l[e].identifier===t)return{touch:l[e],index:e};return null}function g(e){var t=a.getBoundingClientRect();let n;return n=i?(e.clientY-t.top)/t.height*100:(e.clientX-t.left)/t.width*100,Math.max(0,Math.min(100,n))}function e(t){if(t.preventDefault(),DEBUG&&console.log(u+": touchstart - targetTouches: "+t.targetTouches.length),setControlActive(u,!0),i&&1===t.targetTouches.length){var e=Date.now();if(e-d<300){if(2===++m){var n=g(t.targetTouches[0]);if(Math.abs(n-c)<=15)return DEBUG&&console.log(u+": Duplo toque detectado na zona zero, forçando reset"),i?h.style.transition="top 0.3s ease-out":h.style.transition="left 0.3s ease-out",p(c),setTimeout(()=>{i?h.style.transition="top 0.1s ease-out":h.style.transition="left 0.1s ease-out"},300),void(m=0)}}else m=1;d=e}for(let e=0;e<t.targetTouches.length;e++){var o,r,s=t.targetTouches[e];C(s.identifier)||(o=g(s),r={identifier:s.identifier,startX:s.clientX,startY:s.clientY,currentPercent:o,initialPercent:o},l.push(r),1===l.length&&(h.style.transition="none",p(o),DEBUG)&&console.log(`${u}: Primeiro toque iniciado (ID: ${s.identifier})`))}}function t(t){t.preventDefault();for(let e=0;e<t.targetTouches.length;e++){var n,o,r=t.targetTouches[e],s=C(r.identifier);s&&(o=r.clientX-s.touch.startX,r=r.clientY-s.touch.startY,n=i?a.clientHeight:a.clientWidth,r=(i?r:o)/n*100,o=s.touch.initialPercent+r,s.touch.currentPercent=o,0===s.index)&&p(o)}}function f(t){t.preventDefault(),DEBUG&&console.log(u+": touchend - changedTouches: "+t.changedTouches.length);for(let e=0;e<t.changedTouches.length;e++){var n=t.changedTouches[e],o=C(n.identifier);o&&(DEBUG&&console.log(`${u}: Removendo toque (ID: ${n.identifier})`),l.splice(o.index,1),0===l.length)&&(DEBUG&&console.log(u+": Último toque removido, retornando ao zero"),setControlActive(u,!1),y())}}function S(e){DEBUG&&console.log(u+": touchcancel"),f(e)}function v(t){if(!(0<l.length)){t.preventDefault(),o=!0,setControlActive(u,!0);var n=a.getBoundingClientRect();let e;e=i?(t.clientY-n.top)/n.height*100:(t.clientX-n.left)/n.width*100,r={x:t.clientX,y:t.clientY},s=e,h.style.transition="none",p(e),DEBUG&&console.log(`${u}: Mouse down (${e.toFixed(1)}%)`)}}function w(e){var t,n;o&&(e.preventDefault(),t=e.clientX-r.x,e=e.clientY-r.y,n=i?a.clientHeight:a.clientWidth,e=(i?e:t)/n*100,p(s+e))}function b(e){o&&(o=!1,setControlActive(u,!1),y(),DEBUG)&&console.log(u+": Mouse up")}h.addEventListener("touchstart",e,{passive:!1}),h.addEventListener("touchmove",t,{passive:!1}),h.addEventListener("touchend",f,{passive:!1}),h.addEventListener("touchcancel",S,{passive:!1}),a.addEventListener("touchstart",e,{passive:!1}),a.addEventListener("touchmove",t,{passive:!1}),a.addEventListener("touchend",f,{passive:!1}),a.addEventListener("touchcancel",S,{passive:!1}),h.addEventListener("mousedown",v),a.addEventListener("mousedown",v),h.addEventListener("mousemove",w),a.addEventListener("mousemove",w),h.addEventListener("mouseup",b),a.addEventListener("mouseup",b),h.addEventListener("mouseleave",b),a.addEventListener("mouseleave",b),p(c)}else console.error(u+" control elements not found. Retrying in 100ms..."),setTimeout(()=>initGenericControl(u,n),100)}function initSpeedControl(){initGenericControl("speed",sendSpeedCommand)}function initWheelsControl(){initGenericControl("wheels",sendWheelsCommand)}window.showRCPStats=showRCPStats,window.checkWebSocketHealth=checkWebSocketHealth,window.testWebSocketConnectivity=testWebSocketConnectivity,window.runWebSocketDiagnostics=runWebSocketDiagnostics;class ViewInst{constructor(e,t){this.parentCtx=t,this.html=e.cloneNode(!0),this.ctx={},this.setupCloseButtons()}setupCloseButtons(){this.html.querySelectorAll('[data-close-view="true"]').forEach(e=>{e.addEventListener("click",()=>{this.close()})})}setOnclick(e,t){this.html.querySelector("#"+e).onclick=t}close(){document.body.removeChild(this.html)}}class View{constructor(e,t){this.ctr=t,this.template=document.getElementById(e),document.body.removeChild(this.template)}show(e){e=new ViewInst(this.template,e);return this.ctr&&this.ctr(e),document.body.appendChild(e.html),e}}function mainCtr(e){setTimeout(()=>{initSpeedControl(),initWheelsControl()},0),e.setOnclick("btnConfiguration",()=>{views.configurationView.show()});let n=e.html.querySelector("#btnHorn");if(n){let t=!1;n.addEventListener("mousedown",e=>{t||(t=!0,n.classList.add("active"),sendHornCommand(!0)),e.preventDefault()}),n.addEventListener("mouseup",e=>{t&&(t=!1,n.classList.remove("active"),sendHornCommand(!1)),e.preventDefault()}),n.addEventListener("mouseleave",e=>{t&&(t=!1,n.classList.remove("active"),sendHornCommand(!1))}),n.addEventListener("touchstart",e=>{t||(t=!0,n.classList.add("active"),sendHornCommand(!0)),e.preventDefault(),e.stopPropagation()}),n.addEventListener("touchend",e=>{t&&(t=!1,n.classList.remove("active"),sendHornCommand(!1)),e.preventDefault(),e.stopPropagation()}),n.addEventListener("touchcancel",e=>{t&&(t=!1,n.classList.remove("active"),sendHornCommand(!1)),e.preventDefault(),e.stopPropagation()})}let t=e.html.querySelector("#btnLight"),o=!1;t?(t.addEventListener("click",e=>{(o=!o)?t.classList.add("active"):t.classList.remove("active"),sendLightCommand(o),e.preventDefault()}),t.addEventListener("touchend",e=>{e.preventDefault(),e.stopPropagation(),(o=!o)?t.classList.add("active"):t.classList.remove("active"),sendLightCommand(o)})):console.error("Light button not found!")}function netCtr(e){let n=e.html.querySelectorAll(".tab-item"),o=e.html.querySelectorAll(".tab-panel");n.forEach(t=>{t.addEventListener("click",()=>{n.forEach(e=>e.classList.remove("active")),o.forEach(e=>e.classList.remove("active")),t.classList.add("active");var e=t.id.replace("tab","tab")+"Content";document.getElementById(e).classList.add("active")})}),e.html.querySelector("#tabOTA").addEventListener("click",loadOTAStatus),e.html.querySelector("#tabInfo").addEventListener("click",loadSystemInfo),e.html.querySelector("#saveWifiConfig").addEventListener("click",saveWifiConfig),e.html.querySelector("#uploadOTA").addEventListener("click",uploadOTAFirmware),e.html.querySelector("#refreshSystemInfo").addEventListener("click",loadSystemInfo)}async function loadOTAStatus(){try{var e=await(await fetch("/ota/status")).json();document.getElementById("otaStatus").innerHTML=`
            <strong>Partição em execução:</strong> ${e.running_partition}<br>
            <strong>Partição de boot:</strong> ${e.boot_partition}<br>
            <strong>OTA em progresso:</strong> ${e.ota_in_progress?"Sim":"Não"}
        `}catch(e){console.error("Erro ao carregar status OTA:",e),document.getElementById("otaStatus").innerHTML="Erro ao carregar informações do sistema."}}function saveWifiConfig(){var e=document.getElementById("wifiSsid").value;document.getElementById("wifiPassword").value;e?alert("Configuração WiFi salva com sucesso!"):alert("Por favor, insira o nome da rede WiFi")}async function uploadOTAFirmware(){let s=document.getElementById("otaFile");var a=s.files[0];if(a)if(a.name.endsWith(".bin")){let t=document.getElementById("otaProgress"),n=document.getElementById("progressBar"),o=document.getElementById("progressText"),r=document.getElementById("uploadOTA");t.style.display="block",r.disabled=!0,r.textContent="Enviando...";try{(new FormData).append("firmware",a);let e=new XMLHttpRequest;e.upload.addEventListener("progress",e=>{e.lengthComputable&&(e=e.loaded/e.total*100,n.style.width=e+"%",o.textContent=Math.round(e)+"%")}),e.onload=function(){if(200===e.status)try{JSON.parse(e.responseText);alert("Firmware enviado com sucesso! O dispositivo será reiniciado."),s.value="",t.style.display="none"}catch(e){alert("Firmware enviado com sucesso! O dispositivo será reiniciado.")}else alert("Erro no upload: "+e.responseText);r.disabled=!1,r.textContent="Atualizar Firmware",t.style.display="none"},e.onerror=function(){alert("Erro na conexão durante o upload"),r.disabled=!1,r.textContent="Atualizar Firmware",t.style.display="none"},e.open("POST","/ota/upload"),e.send(a)}catch(e){console.error("Erro no upload OTA:",e),alert("Erro ao enviar firmware"),r.disabled=!1,r.textContent="Atualizar Firmware",t.style.display="none"}}else alert("Por favor, selecione um arquivo .bin válido");else alert("Por favor, selecione um arquivo .bin")}async function loadSystemInfo(){try{resetSystemInfoDisplay();let e;if(DEBUG)e={chip:{model:"ESP32-S3",cores:2,revision:3,cpu_freq_mhz:240,has_wifi:!0,has_bluetooth:!0,has_ble:!0,flash_size_mb:16},memory:{heap:{total_bytes:327680,used_bytes:98304,free_bytes:229376,usage_percent:30}},ws_clients:1};else{var t=await fetch("/api/system-info");if(!t.ok)throw new Error("Failed to fetch system info");var n=await t.arrayBuffer();e=parseBinarySystemInfo(n)}updateSystemInfoDisplay(e)}catch(e){console.error("Erro ao carregar informações do sistema:",e),showSystemInfoError()}}function parseBinarySystemInfo(e){var e=new DataView(e),t=["Unknown","ESP32","ESP32-S2","ESP32-S3","ESP32-C3"][e.getUint8(0)]||"Unknown",n=e.getUint8(1),o=e.getUint8(2),r=e.getUint16(3,!0),s=e.getUint8(5),a=0!=(1&s),i=0!=(2&s),c=0!=(4&s),l=e.getUint32(6,!0),d=e.getUint32(10,!0),m=e.getUint32(14,!0),u=e.getUint32(18,!0),h=e.getUint8(22),e=e.getUint8(23);return console.log("RCP Binary System Info received:",{model:t,revision:n,cores:o,freq:r,features:"0x"+s.toString(16),flash:l,heap:m+`/${d}KB (${e}%)`,clients:h}),{chip:{model:t,cores:o,revision:n,cpu_freq_mhz:r,has_wifi:a,has_bluetooth:i,has_ble:c,flash_size_mb:l},memory:{heap:{total_bytes:1024*d,used_bytes:1024*m,free_bytes:1024*u,usage_percent:e}},ws_clients:h}}function resetSystemInfoDisplay(){["chipModel","chipCores","chipRevision","cpuFreq","hasWifi","hasBluetooth","flashSize"].forEach(e=>{e=document.getElementById(e);e&&(e.textContent="Carregando...")}),["heapTotal","heapUsed","heapFree","heapUsage"].forEach(e=>{e=document.getElementById(e);e&&(e.textContent="Carregando...")});["psram","dma","iram","dram"].forEach(e=>{[e+"Total",e+"Used",e+"Free",e+"Usage"].forEach(e=>{e=document.getElementById(e);e&&(e.textContent="N/A")})}),["heapProgressBar","psramProgressBar","dmaProgressBar","iramProgressBar","dramProgressBar"].forEach(e=>{e=document.getElementById(e);e&&(e.style.width="0%")})}function updateSystemInfoDisplay(e){document.getElementById("chipModel").textContent=e.chip.model||"--",document.getElementById("chipCores").textContent=e.chip.cores||"--",document.getElementById("chipRevision").textContent=e.chip.revision||"--",document.getElementById("cpuFreq").textContent=(e.chip.cpu_freq_mhz||"--")+" MHz",document.getElementById("hasWifi").textContent=e.chip.has_wifi?"Sim":"Não",document.getElementById("hasBluetooth").textContent=e.chip.has_bluetooth?"Sim":"Não",document.getElementById("flashSize").textContent=(e.chip.flash_size_mb||"--")+" MB",e.memory&&e.memory.heap&&updateMemoryInfo("heap",e.memory.heap);["psram","dma","iram","dram"].forEach(e=>{[e+"Total",e+"Used",e+"Free",e+"Usage"].forEach(e=>{e=document.getElementById(e);e&&(e.textContent="N/A")});e=document.getElementById(e+"ProgressBar");e&&(e.style.width="0%")}),void 0!==e.ws_clients&&console.log(`RCP Binary System Info: ${e.ws_clients} WebSocket client(s) connected`)}function updateMemoryInfo(e,t){var n=Math.round(t.total_bytes/1024),o=Math.round(t.used_bytes/1024),r=Math.round(t.free_bytes/1024),t=t.usage_percent||0,r=(document.getElementById(e+"Total").textContent=n+" KB",document.getElementById(e+"Used").textContent=o+" KB",document.getElementById(e+"Free").textContent=r+" KB",document.getElementById(e+"Usage").textContent=o+` / ${n} KB (${t}%)`,document.getElementById(e+"ProgressBar"));r&&(r.style.width=t+"%")}function showSystemInfoError(){["chipModel","chipCores","chipRevision","cpuFreq","hasWifi","hasBluetooth","flashSize","heapTotal","heapUsed","heapFree","heapUsage"].forEach(e=>{e=document.getElementById(e);e&&(e.textContent="Erro")});["psram","dma","iram","dram"].forEach(e=>{[e+"Total",e+"Used",e+"Free",e+"Usage"].forEach(e=>{e=document.getElementById(e);e&&(e.textContent="N/A")})})}let batteryLevel=0,batteryDirection=1;function updateBatteryLevel(t){var n=document.querySelectorAll(".battery-level");n.forEach(e=>{e.classList.remove("active")});for(let e=0;e<Math.min(t,10);e++)n[e].classList.add("active")}function startBatteryDebugLoop(){DEBUG&&setInterval(()=>{10<=(batteryLevel+=batteryDirection)?batteryDirection=-1:batteryLevel<=0&&(batteryDirection=1),updateBatteryLevel(batteryLevel)},1e3)}function preventDefaultBehaviors(){document.addEventListener("gesturestart",e=>{e.preventDefault()}),document.addEventListener("gesturechange",e=>{e.preventDefault()}),document.addEventListener("gestureend",e=>{e.preventDefault()});let o=0;document.addEventListener("touchend",e=>{var t,n=(new Date).getTime();n-o<=300&&((t=e.target).closest(".control")||t.closest(".btn")||"btnHorn"===t.id||"btnLight"===t.id||"btnConfiguration"===t.id||e.preventDefault()),o=n},!1),document.addEventListener("contextmenu",e=>{var t=e.target;(t.closest(".control")||t.closest(".btn")||"btnHorn"===t.id||"btnLight"===t.id||"btnConfiguration"===t.id)&&e.preventDefault()})}let views={};function main(){preventDefaultBehaviors(),(DEBUG?startBatteryDebugLoop:initWebSocket)(),views.mainView=new View("mainView",mainCtr),views.configurationView=new View("configurationView",netCtr),views.mainView.show()}window.onload=main</script></head><body><div id=mainView class="gap cols view0"><div class="control speed"><div class=speed-control><div class="control-track speed-track"><div class="control-zero-line speed-zero-line"></div><div class="control-indicator speed-indicator" id=speedIndicator><div class="control-thumb speed-thumb"></div></div></div></div></div><div class="gap space-between grow rows"><div class="gap cols space-between"><div class="gap cols"><div id=btnHorn class="btn btn-horn"><i class="fa-2x fas fa-volume-up"></i></div><div id=btnLight class="btn btn-light"><i class="fa-2x fas fa-lightbulb"></i></div></div><div class="gap cols"><div id=batteryIndicator class=battery-indicator><div class=battery-body><div class="battery-level level-1"></div><div class="battery-level level-2"></div><div class="battery-level level-3"></div><div class="battery-level level-4"></div><div class="battery-level level-5"></div><div class="battery-level level-6"></div><div class="battery-level level-7"></div><div class="battery-level level-8"></div><div class="battery-level level-9"></div><div class="battery-level level-10"></div></div><div class=battery-tip></div></div><div id=btnConfiguration class="btn btn-config"><i class="fa-2x fas fa-cog"></i></div></div></div><div class=colsi><div class="control wheels"><div class=wheels-control><div class="control-track wheels-track"><div class="control-zero-line wheels-zero-line"></div><div class="control-indicator wheels-indicator" id=wheelsIndicator><div class="control-thumb wheels-thumb"></div></div></div></div></div></div></div></div><div id=configurationView class="panel view1"><div class="card wh100"><header class=card-header><span>Configuração</span> <button class=card-close-btn data-close-view=true>✕</button></header><div class=card-body><div class=tab-left><ul><li id=tabGeneral class="tab-item active">General</li><li id=tabWifi class=tab-item>Wifi</li><li id=tabOTA class=tab-item>Update</li><li id=tabInfo class=tab-item>Info</li></ul><div class=tab-content><div id=tabGeneralContent class="tab-panel active"><h3>Configuração Geral</h3><label>Tipo de Conexão:</label> <select id=connectionType><option value=wifi>WiFi</option><option value=bluetooth>Bluetooth</option></select></div><div id=tabWifiContent class=tab-panel><h3>Configuração WiFi</h3><label>Nome do WiFi (SSID):</label> <input id=wifiSsid type=text placeholder="Nome da rede WiFi"> <label>Senha do WiFi:</label> <input id=wifiPassword type=password placeholder="Senha da rede WiFi"><div class=button-group><button id=saveWifiConfig>Gravar</button></div></div><div id=tabOTAContent class=tab-panel><h3>Atualização</h3><div id=otaStatus class=status-info>Carregando informações...</div><label>Selecionar arquivo .bin:</label> <input id=otaFile type=file accept=.bin><div class=button-group><button id=uploadOTA>Atualizar Firmware</button></div><div id=otaProgress class=progress-container style=display:none><div class=progress-bar><div id=progressBar class=progress-fill></div></div><div id=progressText>0%</div></div></div><div id=tabInfoContent class=tab-panel><h3>Informações do Sistema</h3><div id=systemInfo class=system-info><div class=info-section><h4>Chip</h4><div class=info-grid><div class=info-item><span class=info-label>Modelo:</span> <span id=chipModel class=info-value>--</span></div><div class=info-item><span class=info-label>Núcleos:</span> <span id=chipCores class=info-value>--</span></div><div class=info-item><span class=info-label>Revisão:</span> <span id=chipRevision class=info-value>--</span></div><div class=info-item><span class=info-label>Frequência CPU:</span> <span id=cpuFreq class=info-value>-- MHz</span></div><div class=info-item><span class=info-label>WiFi:</span> <span id=hasWifi class=info-value>--</span></div><div class=info-item><span class=info-label>Bluetooth:</span> <span id=hasBluetooth class=info-value>--</span></div><div class=info-item><span class=info-label>Flash:</span> <span id=flashSize class=info-value>-- MB</span></div></div></div><div class=info-section><h4>Memória Heap (Região da RAM usada para alocação dinâmica)</h4><div class=memory-bar><div class=memory-progress><div id=heapProgressBar class=memory-fill></div></div><div class=memory-text><span id=heapUsage>-- / -- KB (-- %)</span></div></div><div class=info-grid><div class=info-item><span class=info-label>Total:</span> <span id=heapTotal class=info-value>-- KB</span></div><div class=info-item><span class=info-label>Usado:</span> <span id=heapUsed class=info-value>-- KB</span></div><div class=info-item><span class=info-label>Livre:</span> <span id=heapFree class=info-value>-- KB</span></div></div></div><div class=info-section><h4>Memória PSRAM (RAM externa)</h4><div class=memory-bar><div class=memory-progress><div id=psramProgressBar class=memory-fill></div></div><div class=memory-text><span id=psramUsage>-- / -- KB (-- %)</span></div></div><div class=info-grid><div class=info-item><span class=info-label>Total:</span> <span id=psramTotal class=info-value>-- KB</span></div><div class=info-item><span class=info-label>Usado:</span> <span id=psramUsed class=info-value>-- KB</span></div><div class=info-item><span class=info-label>Livre:</span> <span id=psramFree class=info-value>-- KB</span></div></div></div><div class=info-section><h4>Memória DMA (Direct Memory Access)</h4><div class=memory-bar><div class=memory-progress><div id=dmaProgressBar class=memory-fill></div></div><div class=memory-text><span id=dmaUsage>-- / -- KB (-- %)</span></div></div><div class=info-grid><div class=info-item><span class=info-label>Total:</span> <span id=dmaTotal class=info-value>-- KB</span></div><div class=info-item><span class=info-label>Usado:</span> <span id=dmaUsed class=info-value>-- KB</span></div><div class=info-item><span class=info-label>Livre:</span> <span id=dmaFree class=info-value>-- KB</span></div></div></div><div class=info-section><h4>Memória IRAM (Instruction RAM)</h4><div class=memory-bar><div class=memory-progress><div id=iramProgressBar class=memory-fill></div></div><div class=memory-text><span id=iramUsage>-- / -- KB (-- %)</span></div></div><div class=info-grid><div class=info-item><span class=info-label>Total:</span> <span id=iramTotal class=info-value>-- KB</span></div><div class=info-item><span class=info-label>Usado:</span> <span id=iramUsed class=info-value>-- KB</span></div><div class=info-item><span class=info-label>Livre:</span> <span id=iramFree class=info-value>-- KB</span></div></div></div><div class=info-section><h4>Memória DRAM (Data RAM)</h4><div class=memory-bar><div class=memory-progress><div id=dramProgressBar class=memory-fill></div></div><div class=memory-text><span id=dramUsage>-- / -- KB (-- %)</span></div></div><div class=info-grid><div class=info-item><span class=info-label>Total:</span> <span id=dramTotal class=info-value>-- KB</span></div><div class=info-item><span class=info-label>Usado:</span> <span id=dramUsed class=info-value>-- KB</span></div><div class=info-item><span class=info-label>Livre:</span> <span id=dramFree class=info-value>-- KB</span></div></div></div><div class=button-group><button id=refreshSystemInfo>Atualizar Informações</button></div></div></div></div></div></div></div></div></body></html>